# Requirements Archive: v1.3 Testing & Script Headers

**Archived:** 2026-02-12
**Status:** SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

# Requirements: v1.3 Testing & Script Headers

**Defined:** 2026-02-11
**Core Value:** Ready-to-run scripts and accessible documentation that eliminate the need to remember tool flags and configurations -- run one command, get what you need.

## v1.3 Requirements

Requirements for the testing and script headers milestone. Each maps to roadmap phases.

### BATS Infrastructure

- [x] **INFRA-01**: BATS-core v1.13.0 + helper libraries installed via git submodules (bats-support v0.3.0, bats-assert v2.2.0, bats-file v0.4.0) — Phase 18, verified
- [x] **INFRA-02**: Shared test helper (`tests/test_helper/common-setup.bash`) handles library loading, PROJECT_ROOT, and strict mode conflict resolution — Phase 18, verified
- [x] **INFRA-03**: `make test` runs full BATS suite; `make test-verbose` shows TAP output — Phase 18, verified
- [x] **INFRA-04**: At least one smoke test proves infrastructure works and strict mode conflicts are handled — Phase 18, verified (5 smoke tests)

### Library Unit Tests

- [x] **UNIT-01**: `parse_common_args` tested for all flag combinations (-h, -v, -q, -x, --, unknown flags, ordering) — Phase 19, 12 tests in lib-args.bats
- [x] **UNIT-02**: `require_cmd`, `require_target`, `check_cmd` tested with present and missing commands — Phase 19, 8 tests in lib-validation.bats
- [x] **UNIT-03**: `info`/`warn`/`error`/`debug` tested for output, LOG_LEVEL filtering, VERBOSE, NO_COLOR — Phase 19, 12 tests in lib-logging.bats
- [x] **UNIT-04**: `make_temp` tested for file/dir creation and EXIT trap cleanup — Phase 19, 6 tests in lib-cleanup.bats
- [x] **UNIT-05**: `run_or_show`, `safety_banner`, `is_interactive` tested for show vs execute mode behavior — Phase 19, 7 tests in lib-output.bats
- [x] **UNIT-06**: `retry_with_backoff` tested for retry count, delay, and success/failure paths — Phase 19, 5 tests in lib-retry.bats

### Script Integration Tests

- [x] **INTG-01**: All scripts exit 0 on `--help` and output contains "Usage:" — Phase 20, 67/67 tests pass
- [x] **INTG-02**: All scripts with `-x` flag reject non-interactive stdin (piped input) — Phase 20, 62/62 tests pass (63 on Linux CI)
- [x] **INTG-03**: Scripts discovered dynamically via glob pattern (no hardcoded script lists) — Phase 20, find-based discovery verified
- [x] **INTG-04**: Mock commands created for CI runners lacking pentesting tools — Phase 20, 19 tool mocks with conditional creation

### CI Integration

- [x] **CI-01**: GitHub Actions workflow runs BATS tests using bats-action@4.0.0 — Phase 21, .github/workflows/tests.yml created
- [x] **CI-02**: Test results reported in JUnit format for GitHub test annotations — Phase 21, --report-formatter junit + action-junit-report@v6
- [x] **CI-03**: BATS tests run alongside existing ShellCheck workflow (independent jobs) — Phase 21, separate workflow files, no needs: dependencies

### Script Headers

- [x] **HDR-01**: Header format defined: bordered comment block with Description, Usage, Dependencies fields between shebang and `source` line — Phase 22, 76 = char bordered format
- [x] **HDR-02**: All 17 `examples.sh` scripts have structured headers — Phase 22, verified
- [x] **HDR-03**: All use-case scripts have structured headers — Phase 22, 46/46 verified
- [x] **HDR-04**: All `lib/*.sh` modules have structured headers — Phase 22, 9/9 verified
- [x] **HDR-05**: All utility scripts (`common.sh`, `check-tools.sh`, diagnostics) have structured headers — Phase 22, 6/6 verified
- [x] **HDR-06**: BATS test validates all `.sh` files have required header fields — Phase 22, 79 tests (78 per-file + 1 meta)

## Deferred (v2+)

### Testing Polish

- **TEST-D01**: Mocking framework (bats-mock) for isolating tool dependencies
- **TEST-D02**: Code coverage via bashcov/kcov
- **TEST-D03**: End-to-end tests against Docker lab targets
- **TEST-D04**: Custom test reporter beyond built-in TAP/JUnit
- **TEST-D05**: Auto-generating `--help` output from script headers

## Out of Scope

| Feature | Reason |
|---------|--------|
| bats-mock mocking framework | Scripts are thin wrappers around real tools; mocking tests the mock, not the script |
| 100% code coverage target | Use-case scripts are educational templates; testing `info "1) Ping scan"` is low-value |
| E2E tests against Docker targets | Requires Docker running, images pulled, services healthy; makes CI fragile |
| shdoc build dependency | Overkill for CLI scripts that already have `show_help()` functions |
| Version field in headers | Git handles versioning; redundant metadata drifts |
| Author field in headers | Git handles attribution; redundant metadata drifts |
| shunit2 framework | BATS is the de facto standard for bash testing; no reason for alternatives |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| INFRA-01 | Phase 18 | Complete |
| INFRA-02 | Phase 18 | Complete |
| INFRA-03 | Phase 18 | Complete |
| INFRA-04 | Phase 18 | Complete |
| UNIT-01 | Phase 19 | Complete |
| UNIT-02 | Phase 19 | Complete |
| UNIT-03 | Phase 19 | Complete |
| UNIT-04 | Phase 19 | Complete |
| UNIT-05 | Phase 19 | Complete |
| UNIT-06 | Phase 19 | Complete |
| INTG-01 | Phase 20 | Complete |
| INTG-02 | Phase 20 | Complete |
| INTG-03 | Phase 20 | Complete |
| INTG-04 | Phase 20 | Complete |
| CI-01 | Phase 21 | Complete |
| CI-02 | Phase 21 | Complete |
| CI-03 | Phase 21 | Complete |
| HDR-01 | Phase 22 | Complete |
| HDR-02 | Phase 22 | Complete |
| HDR-03 | Phase 22 | Complete |
| HDR-04 | Phase 22 | Complete |
| HDR-05 | Phase 22 | Complete |
| HDR-06 | Phase 22 | Complete |

**Coverage:**
- v1.3 requirements: 23 total
- Shipped: 23 (100%)
- Adjusted: 0
- Dropped: 0

---

## Milestone Summary

**Shipped:** 23 of 23 requirements
**Adjusted:** None
**Dropped:** None

---
*Archived: 2026-02-12 as part of v1.3 milestone completion*
