# Requirements Archive: v1.4 JSON Output Mode

**Archived:** 2026-02-14
**Status:** SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

# Requirements: Networking Tools

**Defined:** 2026-02-13
**Core Value:** Ready-to-run scripts and accessible documentation that eliminate the need to remember tool flags and configurations -- run one command, get what you need.

## v1.4 Requirements

Requirements for JSON Output Mode milestone. Each maps to roadmap phases.

### JSON Library

- [x] **JSON-01**: User can get structured JSON output from any use-case script by passing `-j`/`--json` flag -- Implemented in Phase 23, validated in Phase 26
- [x] **JSON-02**: JSON output follows envelope pattern: `{"meta": {...}, "results": [...], "summary": {...}}` -- Implemented in Phase 23, validated in Phase 26
- [x] **JSON-03**: `lib/json.sh` module provides `json_is_active`, `json_set_meta`, `json_add_result`, `json_finalize` functions -- Plus `json_add_example`, implemented in Phase 23
- [x] **JSON-04**: jq is required only when `-j` is used (lazy dependency enforcement) -- Implemented in Phase 23 via _json_check_jq/_json_require_jq pattern
- [x] **JSON-05**: fd3 redirection ensures clean stdout for JSON -- all human output goes to stderr in JSON mode -- Implemented in Phase 23 via exec 3>&1/exec 1>&2
- [x] **JSON-06**: All JSON construction uses `jq -n --arg` for correct RFC 8259 escaping -- Implemented in Phase 23

### Flag Integration

- [x] **FLAG-01**: `-j`/`--json` flag is recognized by `parse_common_args` and sets `OUTPUT_FORMAT=json` -- Implemented in Phase 23, tested in Phase 24
- [x] **FLAG-02**: `-j` works with `-x` (execute mode) to capture and structure real tool output -- Implemented in Phase 23 via 4-path run_or_show
- [x] **FLAG-03**: `-j` works without `-x` (show mode) to output example commands as JSON -- Implemented in Phase 23 via json_add_example
- [x] **FLAG-04**: `confirm_execute()` skips interactive prompt when JSON mode is active -- Implemented in Phase 23, tested in Phase 24
- [x] **FLAG-05**: `NO_COLOR=1` is set automatically when JSON mode is active -- Implemented in Phase 23 with color var reset

### Script Migration

- [x] **SCRIPT-01**: All 46 use-case scripts call `json_set_meta` and `json_finalize` for JSON support -- Completed across Phase 25 plans 01-04
- [x] **SCRIPT-02**: Scripts using `run_or_show` get JSON output automatically via library changes -- Implemented in Phase 23 output.sh, leveraged in Phase 25
- [x] **SCRIPT-03**: Scripts using `info`+`echo` patterns are updated to use JSON accumulation helpers -- json_add_example used across all pure info+echo scripts
- [x] **SCRIPT-04**: Each script's JSON output includes correct tool name, script name, and category in meta -- 7-category taxonomy (network-analysis, network-scanner, web-scanner, sql-injection, password-cracker, exploitation, forensics)

### Testing

- [x] **TEST-01**: BATS unit tests validate `lib/json.sh` functions (envelope assembly, escaping, meta fields) -- 19 tests in Phase 24-01
- [x] **TEST-02**: BATS unit tests validate `-j` flag parsing in `parse_common_args` -- 8 tests in Phase 24-02
- [x] **TEST-03**: BATS integration tests validate every use-case script produces valid JSON with `-j` -- 47 tests in Phase 26-01
- [x] **TEST-04**: JSON output from each script passes `jq .` validation (valid JSON structure) -- Validated in Phase 26

### Documentation

- [x] **DOC-01**: All 46 use-case scripts' `show_help()` mentions `-j`/`--json` flag -- Updated in Phase 27-01, verified in Phase 27-02
- [x] **DOC-02**: Script metadata headers updated to include JSON output capability -- @usage headers updated in Phase 27-01, verified in Phase 27-02

## Future Requirements

Deferred to future release. Tracked but not in current roadmap.

### Structured Tool Output

- **STRUCT-01**: Execute mode parses nmap XML output into structured JSON results
- **STRUCT-02**: Execute mode parses tshark `-T json` output into structured JSON results
- **STRUCT-03**: Execute mode parses nikto native JSON into structured results

### Advanced JSON Features

- **ADV-01**: `--jq EXPR` flag pipes JSON output through jq filter expression
- **ADV-02**: NDJSON streaming mode for long-running execute mode commands
- **ADV-03**: Field selection to limit which envelope fields are emitted

## Out of Scope

Explicitly excluded. Documented to prevent scope creep.

| Feature | Reason |
|---------|--------|
| Pure bash JSON generation (no jq) | Research showed manual escaping is fragile and produces invalid JSON on edge cases. jq `--arg` handles all RFC 8259 escaping correctly. |
| JSON output for `examples.sh` scripts | Lower priority; use-case scripts are the primary automation target. Same pattern applies later. |
| Parsing tool-specific output formats | Raw stdout capture covers all tools immediately. Structured parsing is per-tool work for a future milestone. |
| JSON schema validation (jsonschema) | Overkill for v1.4. `jq .` validation is sufficient to prove structural correctness. |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| JSON-01 | Phase 23 | Complete |
| JSON-02 | Phase 23 | Complete |
| JSON-03 | Phase 23 | Complete |
| JSON-04 | Phase 23 | Complete |
| JSON-05 | Phase 23 | Complete |
| JSON-06 | Phase 23 | Complete |
| FLAG-01 | Phase 23 | Complete |
| FLAG-02 | Phase 23 | Complete |
| FLAG-03 | Phase 23 | Complete |
| FLAG-04 | Phase 23 | Complete |
| FLAG-05 | Phase 23 | Complete |
| SCRIPT-01 | Phase 25 | Complete |
| SCRIPT-02 | Phase 25 | Complete |
| SCRIPT-03 | Phase 25 | Complete |
| SCRIPT-04 | Phase 25 | Complete |
| TEST-01 | Phase 24 | Complete |
| TEST-02 | Phase 24 | Complete |
| TEST-03 | Phase 26 | Complete |
| TEST-04 | Phase 26 | Complete |
| DOC-01 | Phase 27 | Complete |
| DOC-02 | Phase 27 | Complete |

**Coverage:**
- v1.4 requirements: 21 total
- Shipped: 21
- Unmapped: 0

---

## Milestone Summary

**Shipped:** 21 of 21 requirements
**Adjusted:** None
**Dropped:** None

---
*Archived: 2026-02-14 as part of v1.4 milestone completion*
