# Milestone v1.2: Script Hardening

**Status:** SHIPPED 2026-02-11
**Phases:** 12-17
**Total Plans:** 18

## Overview

Transformed 63 educational bash scripts into production-grade dual-mode CLI tools backed by an 8-module library with strict mode, stack traces, structured logging, argument parsing, and ShellCheck compliance with CI enforcement.

## Phases

### Phase 12: Pre-Refactor Cleanup

**Goal**: Codebase is normalized and ready for structural changes -- no inconsistencies that would cause missed scripts during migration
**Depends on**: Phase 11 (v1.1 complete)
**Requirements**: NORM-01, NORM-02, NORM-03
**Plans**: 1 plan

Plans:
- [x] 12-01: Normalize guards, add bash version check, create .shellcheckrc

**Details:**
- Normalized all 63 interactive guards to identical `[[ ! -t 0 ]] && exit 0` syntax (19 variant B patterns replaced)
- Standardized comment above all 63 guards to single consistent format
- Added Bash 4.0+ version guard to common.sh with clear macOS install hint
- Created .shellcheckrc eliminating SC1091 source-resolution warnings

### Phase 13: Library Infrastructure

**Goal**: Scripts source a modular library that provides strict mode, stack traces on error, log-level filtering, automatic temp cleanup, and retry logic -- all behind the existing common.sh entry point
**Depends on**: Phase 12
**Requirements**: STRICT-01, STRICT-02, STRICT-03, STRICT-04, STRICT-05, LOG-01, LOG-02, LOG-03, LOG-04, LOG-05, INFRA-01, INFRA-02, INFRA-03, INFRA-04
**Plans**: 2 plans

Plans:
- [x] 13-01: Create 8 library modules in scripts/lib/ and rewrite common.sh as entry point
- [x] 13-02: Smoke test and backward compatibility verification of all 5 success criteria

**Details:**
- Created 8 library modules: strict.sh, colors.sh, logging.sh, validation.sh, output.sh, cleanup.sh, network.sh, args.sh
- Rewritten common.sh as thin entry point sourcing modules
- 39-check smoke test verifying 22 functions, 9 source guards, PROJECT_ROOT, 6 color variables
- Fixed make_temp() subshell bug with base temp directory pattern

### Phase 14: Argument Parsing and Dual-Mode Pattern

**Goal**: Every script can accept -h, -v, -q, -x flags through a shared parser, and run_or_show() either displays educational content or executes commands based on the flag
**Depends on**: Phase 13
**Requirements**: ARGS-01, ARGS-02, ARGS-03, ARGS-04, DUAL-01
**Plans**: 2 plans

Plans:
- [x] 14-01: Create args.sh module, add run_or_show/confirm_execute to output.sh, pilot-migrate nmap/examples.sh
- [x] 14-02: Automated verification of all 5 success criteria with test script

**Details:**
- Manual while/case/shift argument parser (no getopts/getopt)
- run_or_show() shows educational output by default, executes with -x
- confirm_execute() refuses non-interactive stdin in execute mode
- 30-test verification suite proving all 5 success criteria on nmap pilot

### Phase 15: Examples Script Migration

**Goal**: All 17 examples.sh scripts work in dual mode with consistent flags across every tool
**Depends on**: Phase 14
**Requirements**: DUAL-02, DUAL-04, DUAL-05
**Plans**: 4 plans

Plans:
- [x] 15-01: Migrate 7 simple target-required scripts (dig, hping3, gobuster, ffuf, skipfish, nikto, sqlmap)
- [x] 15-02: Migrate 4 target scripts with edge cases (curl, traceroute, netcat, foremost)
- [x] 15-03: Migrate 5 no-target static scripts (tshark, metasploit, hashcat, john, aircrack-ng)
- [x] 15-04: Extend test suite to verify all 17 scripts

**Details:**
- Static/annotated examples kept as info+echo (no $TARGET, placeholders, or multi-line comments)
- Complex format strings (curl timing) and missing-tool commands (mtr) kept as info+echo
- No-target scripts: all 50 examples are static reference commands, no run_or_show conversions
- Extended test suite from 30 to 84 tests covering all 17 scripts

### Phase 16: Use-Case Script Migration

**Goal**: All 46 use-case scripts work in dual mode with argument parsing
**Depends on**: Phase 15
**Requirements**: DUAL-03
**Plans**: 8 plans

Plans:
- [x] 16-01: Migrate 5 nmap + hping3 use-case scripts
- [x] 16-02: Migrate 6 dig + curl use-case scripts
- [x] 16-03: Migrate 6 nikto + skipfish + ffuf use-case scripts
- [x] 16-04: Migrate 5 gobuster + traceroute use-case scripts
- [x] 16-05: Migrate 6 sqlmap + netcat use-case scripts
- [x] 16-06: Migrate 6 foremost + tshark use-case scripts
- [x] 16-07: Migrate 12 metasploit + hashcat + john + aircrack-ng use-case scripts
- [x] 16-08: Extend test suite to verify all 46 use-case scripts

**Details:**
- Multi-command examples (&&, ;, |) kept as info+echo -- run_or_show for single commands only
- Piped commands (sort | uniq -c, curl | grep) kept as info+echo
- Multi-positional args (TARGET+WORDLIST) preserved through parse_common_args + set --
- Extended test suite from 84 to 268 tests covering all 63 scripts

### Phase 17: ShellCheck Compliance and CI

**Goal**: Every script passes ShellCheck at warning severity with CI enforcement preventing regressions
**Depends on**: Phase 16
**Requirements**: LINT-01, LINT-02, LINT-03, LINT-04
**Plans**: 1 plan

Plans:
- [x] 17-01: Fix 11 ShellCheck warnings, add make lint target, create GitHub Actions CI workflow

**Details:**
- Resolved all 11 ShellCheck warnings (10x SC2034, 1x SC2043) across 6 files
- Added make lint target running ShellCheck with severity=warning
- Created .github/workflows/shellcheck.yml gating PRs on compliance
- Inline SC2034 directives per-assignment (not file-level or global disable)

---

## Milestone Summary

**Key Decisions:**
- 8-file library split (not 2-file) for maintainability
- Manual while/case arg parsing (not getopts/getopt) -- getopts lacks long options; macOS BSD getopt is broken
- ERR trap prints stack trace to stderr (not silent log file)
- Unknown flags pass through to REMAINING_ARGS (permissive)
- EXECUTE_MODE defaults to "show" -- all scripts backward compatible without code changes
- Base temp directory instead of array tracking for make_temp -- avoids subshell array loss
- Inline SC2034 directives per-assignment (not file-level or .shellcheckrc global disable)
- Removed unused RESOLVERS array rather than suppressing warning

**Issues Resolved:**
- Fixed make_temp() subshell bug where array modifications in command substitution were lost
- Fixed ERR trap noise in test subshells (clear trap after sourcing common.sh)
- Fixed missing confirm_execute in john/identify-hash-type.sh
- Resolved all 11 ShellCheck warnings across 6 files

**Issues Deferred:**
- JSON output mode (--json flag) — deferred to v2+
- Bash completion scripts — deferred to v2+
- Execution timer — deferred to v2+

**Technical Debt Incurred:**
- Piped/multi-command examples cannot use run_or_show (single command only)
- Some structural-only migrations (0 run_or_show conversions) for scripts with all-pipe examples
- SC2034 inline suppressions for color variables used by other modules

---

_For current project status, see .planning/ROADMAP.md_
