# Phase 10: Navigation Cleanup - Research

**Researched:** 2026-02-11
**Domain:** Astro Starlight sidebar configuration / frontmatter
**Confidence:** HIGH

## Summary

The sidebar navigation currently shows redundant entries because each section directory (`tools/`, `guides/`, `diagnostics/`) contains an `index.md` file. When Starlight's `autogenerate` sidebar option processes these directories, each `index.md` becomes a regular link inside its own group -- so the "Tools" group contains a "Tools" link, "Guides" contains a "Guides" link, etc. This is the redundancy the phase aims to remove.

Starlight v0.37.6 (the installed version) provides a built-in frontmatter property `sidebar.hidden: true` that prevents a page from appearing in autogenerated sidebar groups while keeping the page itself accessible via direct URL. This is the exact, intended solution for this problem -- no config changes, no CSS hacks, no custom components needed.

**Primary recommendation:** Add `sidebar: { hidden: true }` to the frontmatter of the three index files (`tools/index.md`, `guides/index.md`, `diagnostics/index.md`). Do not delete these files, as they serve as landing pages linked from the homepage and other content.

## Standard Stack

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| @astrojs/starlight | 0.37.6 | Documentation framework with sidebar | Already installed; provides `sidebar.hidden` frontmatter |
| astro | 5.6.1 | Static site generator | Already installed |

### Supporting
No additional libraries needed. This phase uses only built-in Starlight frontmatter features.

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| `sidebar.hidden` frontmatter | Delete index.md files entirely | Would break existing links from homepage hero (`/networking-tools/guides/`) and cross-references from `getting-started.md` (`../tools/`). NOT recommended. |
| `sidebar.hidden` frontmatter | Manual sidebar config (replace `autogenerate`) | Would require listing every page manually in `astro.config.mjs`, defeating the purpose of autogenerate. NOT recommended. |
| `sidebar.hidden` frontmatter | CSS `display:none` on specific sidebar items | Fragile, depends on Starlight's internal DOM structure, not semantic. NOT recommended. |

## Architecture Patterns

### Current State
```
site/src/content/docs/
├── index.md              # Homepage (splash template, not in sidebar)
├── tools/
│   ├── index.md          # "Tools" landing page -- APPEARS IN SIDEBAR (redundant)
│   ├── nmap.mdx
│   ├── tshark.mdx
│   └── ... (16 more tool pages)
├── guides/
│   ├── index.md          # "Guides" landing page -- APPEARS IN SIDEBAR (redundant)
│   ├── getting-started.md
│   └── ... (5 more guide pages)
└── diagnostics/
    ├── index.md          # "Diagnostics" landing page -- APPEARS IN SIDEBAR (redundant)
    ├── dns.md
    ├── connectivity.md
    └── performance.md
```

### Target State
Same file structure, but each section's `index.md` has `sidebar.hidden: true` in its frontmatter. Sidebar renders groups without redundant self-referencing links.

### Pattern: Hide Index Page from Autogenerated Sidebar
**What:** Use `sidebar.hidden: true` frontmatter to prevent a page from appearing in its autogenerated sidebar group.
**When to use:** When an `index.md` creates a redundant entry inside its own sidebar group.
**Example:**
```yaml
# Source: Starlight frontmatter schema (verified in node_modules/@astrojs/starlight/schema.ts lines 64-83)
---
title: Tools
description: Security and networking tool references
sidebar:
  hidden: true
---
```

### How Starlight Processes This
1. `autogenerate: { directory: 'tools' }` in `astro.config.mjs` tells Starlight to scan `src/content/docs/tools/`
2. Starlight's `treeify()` function (in `utils/navigation.ts` line 237) filters out pages where `doc.entry.data.sidebar.hidden === true` at line 241, BEFORE building the sidebar tree
3. The filtered page still exists as a routable page -- it just does not appear in the sidebar
4. The group label ("Tools") remains as a non-clickable header in the sidebar

### Anti-Patterns to Avoid
- **Deleting index.md files:** The homepage hero action links to `/networking-tools/guides/` and `getting-started.md` links to `../tools/`. Deleting index files would create broken links (404s).
- **Switching to manual sidebar items:** Defeats the purpose of `autogenerate`. Any new tool page would need a manual config entry.
- **Using CSS to hide entries:** Fragile, not semantic, breaks if Starlight updates internal DOM structure.

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Hiding sidebar entries | Custom Astro component override for sidebar | `sidebar.hidden` frontmatter | Built-in, one line of YAML per file, officially supported |
| Removing group self-links | CSS selectors targeting specific sidebar items | `sidebar.hidden` frontmatter | CSS approach is fragile and depends on internal DOM |

**Key insight:** This is a three-line change across three files. Starlight already solved this problem with `sidebar.hidden`. No custom code needed.

## Common Pitfalls

### Pitfall 1: Deleting Index Pages Instead of Hiding Them
**What goes wrong:** Pages that other content links to return 404.
**Why it happens:** It seems simpler to remove the file than add frontmatter.
**How to avoid:** Verify all internal links before considering deletion. In this project, `index.md` (homepage) links to `/networking-tools/guides/` and `getting-started.md` links to `../tools/`.
**Warning signs:** Broken links after deployment, 404 errors in build output.

### Pitfall 2: Forgetting to Verify All Pages Remain Reachable
**What goes wrong:** A page is accidentally removed or its URL changes, breaking cross-references.
**How to avoid:** After making changes, verify the site builds without errors. Check that all three index pages are still accessible via their URLs.
**Warning signs:** Astro build warnings about missing pages.

### Pitfall 3: Applying Hidden to Wrong Files
**What goes wrong:** Accidentally hiding actual content pages instead of just the redundant index pages.
**How to avoid:** Only modify the three `index.md` files in `tools/`, `guides/`, and `diagnostics/`. The root `index.md` (homepage) uses `template: splash` and is NOT in any sidebar group -- do not touch it.
**Warning signs:** Pages disappearing from sidebar that should remain.

## Code Examples

Verified patterns from the installed Starlight source:

### Hide a Page from Autogenerated Sidebar
```yaml
# Source: Verified in @astrojs/starlight/schema.ts lines 64-83
# and @astrojs/starlight/utils/navigation.ts line 241
---
title: Tools
description: Security and networking tool references
sidebar:
  hidden: true
---
```

### Files to Modify

**`site/src/content/docs/tools/index.md`** -- currently:
```yaml
---
title: Tools
description: Security and networking tool references
---
```
Change to:
```yaml
---
title: Tools
description: Security and networking tool references
sidebar:
  hidden: true
---
```

**`site/src/content/docs/guides/index.md`** -- currently:
```yaml
---
title: Guides
description: Getting started and learning paths
---
```
Change to:
```yaml
---
title: Guides
description: Getting started and learning paths
sidebar:
  hidden: true
---
```

**`site/src/content/docs/diagnostics/index.md`** -- currently:
```yaml
---
title: Diagnostics
description: Network diagnostic scripts and reports
---
```
Change to:
```yaml
---
title: Diagnostics
description: Network diagnostic scripts and reports
sidebar:
  hidden: true
---
```

### Sidebar Config (No Changes Needed)
The `astro.config.mjs` sidebar configuration remains exactly as-is:
```javascript
sidebar: [
  { label: 'Tools', autogenerate: { directory: 'tools' } },
  { label: 'Guides', autogenerate: { directory: 'guides' } },
  { label: 'Diagnostics', autogenerate: { directory: 'diagnostics' } },
],
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| No way to hide autogenerated entries | `sidebar.hidden` frontmatter | Available in Starlight 0.x (present in 0.37.6) | One-line frontmatter solves redundant index entries |

**Note:** Starlight group headers are non-clickable labels, not links. There is no built-in way to make a group header link to its index page. The `sidebar.hidden` approach is the recommended pattern for index pages that serve as landing pages but should not appear as redundant links in the sidebar.

## Open Questions

None. This is a straightforward, well-documented Starlight feature. The implementation path is clear.

## Verification Strategy

After applying changes:
1. Run `npm run build` in `site/` -- should complete with no errors or warnings
2. Run `npm run dev` in `site/` -- visually confirm:
   - "Tools" group no longer shows a "Tools" link inside it
   - "Guides" group no longer shows a "Guides" link inside it
   - "Diagnostics" group no longer shows a "Diagnostics" link inside it
   - All other sidebar entries (individual tool pages, guide pages, diagnostic pages) remain present
3. Navigate to `/networking-tools/tools/`, `/networking-tools/guides/`, `/networking-tools/diagnostics/` directly -- pages should still load (they are hidden from sidebar, not deleted)
4. Verify homepage hero "Get Started" link still works (links to `/networking-tools/guides/`)

## Sources

### Primary (HIGH confidence)
- **Starlight source code** (`site/node_modules/@astrojs/starlight/schema.ts` lines 64-83) -- Confirmed `sidebar.hidden` field exists as `z.boolean().default(false)` with description "Prevents this page from being included in autogenerated sidebar groups"
- **Starlight source code** (`site/node_modules/@astrojs/starlight/utils/navigation.ts` line 241) -- Confirmed filter: `.filter((doc) => !doc.entry.data.sidebar.hidden)` runs before sidebar tree construction
- **Starlight frontmatter reference** (https://starlight.astro.build/reference/frontmatter/) -- Documents `sidebar.hidden` as official API

### Secondary (MEDIUM confidence)
- **Starlight sidebar guide** (https://starlight.astro.build/guides/sidebar/) -- Describes sidebar frontmatter options including hiding links

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH -- Using only built-in Starlight features already installed at correct version
- Architecture: HIGH -- Verified exact behavior by reading Starlight source code
- Pitfalls: HIGH -- Cross-referenced all internal links to confirm no breakage from hiding (not deleting) pages

**Research date:** 2026-02-11
**Valid until:** 2026-04-11 (stable; `sidebar.hidden` is a core Starlight feature unlikely to change)
