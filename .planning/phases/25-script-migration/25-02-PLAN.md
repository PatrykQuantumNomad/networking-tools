---
phase: 25-script-migration
plan: 02
type: execute
wave: 2
depends_on: ["25-01"]
files_modified:
  - scripts/aircrack-ng/analyze-wireless-networks.sh
  - scripts/aircrack-ng/capture-handshake.sh
  - scripts/aircrack-ng/crack-wpa-handshake.sh
  - scripts/hashcat/crack-ntlm-hashes.sh
  - scripts/hashcat/crack-web-hashes.sh
  - scripts/john/crack-archive-passwords.sh
  - scripts/john/crack-linux-passwords.sh
  - scripts/john/identify-hash-type.sh
  - scripts/metasploit/generate-reverse-shell.sh
  - scripts/metasploit/scan-network-services.sh
  - scripts/metasploit/setup-listener.sh
autonomous: true

must_haves:
  truths:
    - "All 11 password-cracker + exploitation scripts produce valid JSON with -j"
    - "Each script's json_set_meta uses the correct tool, target variable, and category"
    - "All 10 info+echo examples per script have corresponding json_add_example calls"
    - "json_finalize is placed before the interactive demo block in every script"
  artifacts:
    - path: "scripts/hashcat/crack-ntlm-hashes.sh"
      provides: "JSON support for NTLM hash cracking"
      contains: "json_set_meta"
    - path: "scripts/john/crack-linux-passwords.sh"
      provides: "JSON support for Linux password cracking"
      contains: "json_add_example"
    - path: "scripts/metasploit/setup-listener.sh"
      provides: "JSON support for Metasploit listener"
      contains: "json_finalize"
    - path: "scripts/aircrack-ng/capture-handshake.sh"
      provides: "JSON support for WPA handshake capture"
      contains: "json_set_meta"
  key_links:
    - from: "scripts/hashcat/*.sh"
      to: "scripts/lib/json.sh"
      via: "json_add_example calls for all 10 examples"
      pattern: "json_add_example"
    - from: "scripts/john/*.sh"
      to: "scripts/lib/json.sh"
      via: "json_add_example calls for all 10 examples"
      pattern: "json_add_example"
---

<objective>
Migrate 11 Group C scripts (pure info+echo) in the password-cracker and exploitation tool families to produce JSON output.

Purpose: These 11 scripts have zero run_or_show calls -- every example uses bare info+echo patterns that need explicit json_add_example calls to appear in JSON output.
Output: 11 scripts producing valid JSON with all examples captured when invoked with `-j`.
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-script-migration/25-RESEARCH.md
@.planning/phases/25-script-migration/25-01-SUMMARY.md
@scripts/lib/json.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate password-cracker scripts (hashcat 2, john 3 = 5 scripts)</name>
  <files>
scripts/hashcat/crack-ntlm-hashes.sh
scripts/hashcat/crack-web-hashes.sh
scripts/john/crack-archive-passwords.sh
scripts/john/crack-linux-passwords.sh
scripts/john/identify-hash-type.sh
  </files>
  <action>
For each script, add three types of changes:

**1. json_set_meta** — AFTER the primary variable assignment, BEFORE confirm_execute:

| Script | Tool | Target Var | Category |
|--------|------|-----------|----------|
| hashcat/crack-ntlm-hashes.sh | hashcat | $HASHFILE | password-cracker |
| hashcat/crack-web-hashes.sh | hashcat | $HASHFILE | password-cracker |
| john/crack-archive-passwords.sh | john | $TARGET | password-cracker |
| john/crack-linux-passwords.sh | john | $SHADOW_FILE (or equivalent) | password-cracker |
| john/identify-hash-type.sh | john | $HASH | password-cracker |

Check each script for the exact variable name used for the primary parameter. Use that variable in json_set_meta. If no target variable exists, pass empty string.

**2. json_add_example for every numbered example** — After each `info "N) ..."` + `echo "   command..."` pair, add:
```bash
json_add_example "N) Title matching the info call" "command matching the echo line"
```

The description string must match the info() call exactly. The command string must match the echo line (without leading whitespace). Example:
```bash
info "1) Dictionary attack on NTLM hashes"
echo "   hashcat -m 1000 -a 0 ${HFILE} ${WORDLIST}"
json_add_example "1) Dictionary attack on NTLM hashes" "hashcat -m 1000 -a 0 ${HFILE} ${WORDLIST}"
echo ""
```

For scripts where examples span multiple echo lines (e.g., "Step 1: ... Step 2: ..."), combine into a single json_add_example with the primary command.

**3. json_finalize** — BEFORE the interactive demo block (`if [[ "${EXECUTE_MODE:-show}" == "show" ]]; then`).

Each script has ~10 examples, so expect ~10 json_add_example calls per script plus the 2 boilerplate lines.
  </action>
  <verify>
For each script, run:
```bash
bash scripts/hashcat/crack-ntlm-hashes.sh -j 3>&1 1>/dev/null 2>/dev/null | jq -e '
    .meta.tool == "hashcat" and
    .meta.category == "password-cracker" and
    (.results | length) >= 10
'
```
Repeat for all 5 scripts with appropriate tool/category values.
  </verify>
  <done>All 5 password-cracker scripts produce valid JSON with correct meta fields and all examples captured as results.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate exploitation scripts (aircrack-ng 3, metasploit 3 = 6 scripts)</name>
  <files>
scripts/aircrack-ng/analyze-wireless-networks.sh
scripts/aircrack-ng/capture-handshake.sh
scripts/aircrack-ng/crack-wpa-handshake.sh
scripts/metasploit/generate-reverse-shell.sh
scripts/metasploit/scan-network-services.sh
scripts/metasploit/setup-listener.sh
  </files>
  <action>
Same 3-change pattern as Task 1:

**1. json_set_meta** with correct mapping:

| Script | Tool | Target Var | Category |
|--------|------|-----------|----------|
| aircrack-ng/analyze-wireless-networks.sh | aircrack-ng | $INTERFACE | exploitation |
| aircrack-ng/capture-handshake.sh | aircrack-ng | $INTERFACE | exploitation |
| aircrack-ng/crack-wpa-handshake.sh | aircrack-ng | $CAPFILE (or equivalent) | exploitation |
| metasploit/generate-reverse-shell.sh | metasploit | $LHOST | exploitation |
| metasploit/scan-network-services.sh | metasploit | $TARGET | exploitation |
| metasploit/setup-listener.sh | metasploit | $LHOST | exploitation |

Check each script for the exact primary parameter variable name.

**2. json_add_example** for every numbered example, same pattern as Task 1.

**3. json_finalize** before the interactive demo block.

Note: metasploit scripts may have multi-line examples showing msfconsole commands. For json_add_example, use the primary msfconsole command as the command string.
  </action>
  <verify>
For each script, run:
```bash
bash scripts/aircrack-ng/analyze-wireless-networks.sh -j 3>&1 1>/dev/null 2>/dev/null | jq -e '
    .meta.tool == "aircrack-ng" and
    .meta.category == "exploitation" and
    (.results | length) >= 10
'
```
Repeat for all 6 scripts with appropriate tool/category values.
  </verify>
  <done>All 6 exploitation scripts produce valid JSON with correct meta fields and all examples captured as results.</done>
</task>

</tasks>

<verification>
1. `grep -r 'json_set_meta' scripts/{hashcat,john,aircrack-ng,metasploit}/ | wc -l` — returns 11
2. `grep -r 'json_finalize' scripts/{hashcat,john,aircrack-ng,metasploit}/ | wc -l` — returns 11
3. `grep -r 'json_add_example' scripts/{hashcat,john,aircrack-ng,metasploit}/ | wc -l` — returns ~110 (10 per script)
4. Spot-check 2-3 scripts with `-j` flag produce valid JSON via `jq .`
</verification>

<success_criteria>
- All 11 scripts have json_set_meta, json_finalize, and json_add_example calls
- Each script produces valid JSON output with `-j` containing all numbered examples
- Category is "password-cracker" for hashcat/john scripts and "exploitation" for aircrack-ng/metasploit scripts
- No existing script behavior is altered when run without `-j`
</success_criteria>

<output>
After completion, create `.planning/phases/25-script-migration/25-02-SUMMARY.md`
</output>
