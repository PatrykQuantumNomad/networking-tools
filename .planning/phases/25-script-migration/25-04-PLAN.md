---
phase: 25-script-migration
plan: 04
type: execute
wave: 2
depends_on: ["25-01"]
files_modified:
  - scripts/curl/test-http-endpoints.sh
  - scripts/dig/attempt-zone-transfer.sh
  - scripts/gobuster/discover-directories.sh
  - scripts/gobuster/enumerate-subdomains.sh
  - scripts/hashcat/benchmark-gpu.sh
  - scripts/hping3/detect-firewall.sh
  - scripts/hping3/test-firewall-rules.sh
  - scripts/netcat/scan-ports.sh
  - scripts/nikto/scan-with-auth.sh
  - scripts/nmap/identify-ports.sh
  - scripts/sqlmap/dump-database.sh
  - scripts/traceroute/compare-routes.sh
  - scripts/tshark/analyze-dns-queries.sh
  - scripts/tshark/capture-http-credentials.sh
autonomous: true

must_haves:
  truths:
    - "All 14 mixed scripts produce valid JSON with -j"
    - "Bare info+echo examples have json_add_example calls while run_or_show examples are untouched"
    - "Each script's JSON output contains all examples (both run_or_show and bare info+echo)"
    - "json_finalize is placed before the interactive demo block in every script"
  artifacts:
    - path: "scripts/nmap/identify-ports.sh"
      provides: "JSON support with 6 json_add_example + 4 run_or_show"
      contains: "json_add_example"
    - path: "scripts/sqlmap/dump-database.sh"
      provides: "JSON support with 5 json_add_example + 5 run_or_show"
      contains: "json_add_example"
    - path: "scripts/curl/test-http-endpoints.sh"
      provides: "JSON support with 8 json_add_example + 2 run_or_show"
      contains: "json_add_example"
  key_links:
    - from: "scripts/nmap/identify-ports.sh"
      to: "scripts/lib/json.sh"
      via: "json_add_example for 6 bare examples, run_or_show handles 4 automatically"
      pattern: "json_add_example"
    - from: "scripts/dig/attempt-zone-transfer.sh"
      to: "scripts/lib/json.sh"
      via: "json_add_example for 7 bare examples, run_or_show handles 3 automatically"
      pattern: "json_add_example"
---

<objective>
Migrate all 14 Group B scripts (mixed run_or_show + info+echo) to produce JSON output.

Purpose: These scripts have a mix of run_or_show calls (which get JSON capture automatically) and bare info+echo examples (which need explicit json_add_example calls). Only the bare examples need json_add_example -- the run_or_show examples are already handled by the library.
Output: 14 scripts producing valid JSON with ALL examples (both types) captured when invoked with `-j`.
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-script-migration/25-RESEARCH.md
@.planning/phases/25-script-migration/25-01-SUMMARY.md
@scripts/lib/json.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate mixed scripts with fewer bare examples (8 scripts, 1-3 bare examples each)</name>
  <files>
scripts/hashcat/benchmark-gpu.sh
scripts/hping3/detect-firewall.sh
scripts/hping3/test-firewall-rules.sh
scripts/gobuster/discover-directories.sh
scripts/gobuster/enumerate-subdomains.sh
scripts/netcat/scan-ports.sh
scripts/tshark/analyze-dns-queries.sh
scripts/tshark/capture-http-credentials.sh
  </files>
  <action>
For each script, add three types of changes. Key: only add json_add_example for bare info+echo examples. Do NOT touch run_or_show examples -- they are captured automatically.

**1. json_set_meta** with correct mapping:

| Script | Tool | Target Var | Category | Bare Examples |
|--------|------|-----------|----------|---------------|
| hashcat/benchmark-gpu.sh | hashcat | "" | password-cracker | 1 |
| hping3/detect-firewall.sh | hping3 | $TARGET | network-scanner | 1 |
| hping3/test-firewall-rules.sh | hping3 | $TARGET | network-scanner | 1 |
| gobuster/discover-directories.sh | gobuster | $TARGET | web-scanner | 2 |
| gobuster/enumerate-subdomains.sh | gobuster | $TARGET | web-scanner | 3 |
| netcat/scan-ports.sh | netcat | $TARGET | network-scanner | 3 |
| tshark/analyze-dns-queries.sh | tshark | $TARGET | network-analysis | 3 |
| tshark/capture-http-credentials.sh | tshark | $TARGET | network-analysis | 2 |

Note: hashcat/benchmark-gpu.sh has no target — pass empty string.

**2. json_add_example ONLY for bare info+echo examples.** Read each script to identify which examples use `run_or_show` (skip those) and which use bare `info` + `echo` (add json_add_example). The research provides counts but you must verify by reading each script.

For netcat/scan-ports.sh, some bare examples may have NC_VARIANT branching -- handle the same way as Plan 03 (json_add_example inside each branch).

**3. json_finalize** before the interactive demo block.
  </action>
  <verify>
For each script, run:
```bash
bash scripts/gobuster/discover-directories.sh -j example.com 3>&1 1>/dev/null 2>/dev/null | jq -e '
    .meta.tool == "gobuster" and
    .meta.category == "web-scanner" and
    (.results | length) == 10
'
```
Repeat for all 8 scripts. Verify the total results count matches the expected number of examples (typically 10).
  </verify>
  <done>All 8 scripts produce valid JSON with correct meta fields. Both run_or_show and bare info+echo examples appear in the results array.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate mixed scripts with more bare examples (6 scripts, 4-8 bare examples each)</name>
  <files>
scripts/curl/test-http-endpoints.sh
scripts/dig/attempt-zone-transfer.sh
scripts/nikto/scan-with-auth.sh
scripts/nmap/identify-ports.sh
scripts/sqlmap/dump-database.sh
scripts/traceroute/compare-routes.sh
  </files>
  <action>
Same pattern as Task 1 but these scripts have more bare info+echo examples.

**1. json_set_meta** with correct mapping:

| Script | Tool | Target Var | Category | Bare Examples |
|--------|------|-----------|----------|---------------|
| curl/test-http-endpoints.sh | curl | $TARGET | network-analysis | 8 |
| dig/attempt-zone-transfer.sh | dig | $TARGET | network-analysis | 7 |
| nikto/scan-with-auth.sh | nikto | $TARGET | web-scanner | 4 |
| nmap/identify-ports.sh | nmap | $TARGET | network-scanner | 6 |
| sqlmap/dump-database.sh | sqlmap | $TARGET | sql-injection | 5 |
| traceroute/compare-routes.sh | traceroute | $TARGET | network-analysis | 4 |

**2. json_add_example** for each bare info+echo example. Read each script carefully to distinguish run_or_show calls from bare info+echo patterns:

For nmap/identify-ports.sh: Examples 1-5 are bare info+echo (local lsof/netstat commands that cannot be run remotely), examples 6-9 are run_or_show, example 10 is bare info+echo. Add json_add_example for examples 1-5 and 10 only.

For curl/test-http-endpoints.sh: Mostly bare info+echo with only 2 run_or_show calls. Add json_add_example for the 8 bare examples.

For dig/attempt-zone-transfer.sh: 3 run_or_show and 7 bare info+echo. Add json_add_example for the 7 bare examples.

For multi-line echo commands (e.g., showing both a command and its explanation), use the primary command in json_add_example.

**3. json_finalize** before the interactive demo block.
  </action>
  <verify>
For each script, run:
```bash
bash scripts/nmap/identify-ports.sh -j localhost 3>&1 1>/dev/null 2>/dev/null | jq -e '
    .meta.tool == "nmap" and
    .meta.category == "network-scanner" and
    (.results | length) == 10
'
```
Repeat for all 6 scripts. Verify results count matches total examples (typically 10, traceroute/compare-routes.sh has 12).
  </verify>
  <done>All 6 scripts produce valid JSON with correct meta fields. Both run_or_show and bare info+echo examples appear in the results array with the correct total count.</done>
</task>

</tasks>

<verification>
1. `grep -r 'json_set_meta' scripts/ --include='*.sh' | grep -v lib/ | grep -v examples | wc -l` — returns 46 (all scripts across all plans)
2. `grep -r 'json_finalize' scripts/ --include='*.sh' | grep -v lib/ | grep -v examples | wc -l` — returns 46
3. For each of the 14 scripts, `jq -e '.results | length'` on the JSON output matches the expected example count
4. `grep -r 'json_add_example' scripts/ --include='*.sh' | grep -v lib/ | wc -l` — returns ~245 total (bare examples across all plans)
</verification>

<success_criteria>
- All 14 mixed scripts have json_set_meta, json_finalize, and json_add_example calls
- json_add_example is ONLY on bare info+echo examples, NOT on run_or_show examples
- Each script's JSON output contains ALL examples regardless of capture method
- Correct categories used for each tool
- No existing script behavior is altered when run without `-j`
- Combined with Plans 01-03, all 46 use-case scripts now produce valid JSON
</success_criteria>

<output>
After completion, create `.planning/phases/25-script-migration/25-04-SUMMARY.md`
</output>
