---
phase: 15-examples-script-migration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/curl/examples.sh
  - scripts/traceroute/examples.sh
  - scripts/netcat/examples.sh
  - scripts/foremost/examples.sh
autonomous: true

must_haves:
  truths:
    - "Running any of the 4 migrated scripts with --help prints usage and exits 0"
    - "Running any of the 4 migrated scripts with a target (no -x) produces identical educational output to pre-migration"
    - "Running any of the 4 migrated scripts with -x and piped stdin rejects with interactive terminal warning"
    - "Netcat variant-specific case statements are preserved unchanged in show mode"
    - "Traceroute platform-conditional example 5 is preserved unchanged in show mode"
    - "Foremost works both with and without a target argument"
  artifacts:
    - path: "scripts/curl/examples.sh"
      provides: "curl dual-mode examples"
      contains: "parse_common_args"
    - path: "scripts/traceroute/examples.sh"
      provides: "traceroute dual-mode examples"
      contains: "parse_common_args"
    - path: "scripts/netcat/examples.sh"
      provides: "netcat dual-mode examples"
      contains: "parse_common_args"
    - path: "scripts/foremost/examples.sh"
      provides: "foremost dual-mode examples"
      contains: "parse_common_args"
  key_links:
    - from: "each migrated script"
      to: "scripts/lib/args.sh"
      via: "parse_common_args call"
      pattern: "parse_common_args"
    - from: "each migrated script"
      to: "scripts/lib/output.sh"
      via: "run_or_show and confirm_execute calls"
      pattern: "run_or_show|confirm_execute"
---

<objective>
Migrate 4 target-required scripts with edge cases to the dual-mode pattern: curl, traceroute, netcat, foremost.

Purpose: These scripts have per-example complexity (variant case statements, platform conditionals, optional target, pipe syntax) that requires careful handling beyond the mechanical pattern.
Output: 4 scripts accepting -h/-v/-q/-x flags with appropriate run_or_show for eligible examples and preserved edge-case patterns.
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-examples-script-migration/15-RESEARCH.md
@.planning/phases/14-argument-parsing-and-dual-mode-pattern/14-01-SUMMARY.md
@scripts/nmap/examples.sh (reference pattern -- already migrated)
@scripts/lib/args.sh
@scripts/lib/output.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate curl and traceroute to dual-mode pattern</name>
  <files>
    scripts/curl/examples.sh
    scripts/traceroute/examples.sh
  </files>
  <action>
Apply the nmap migration pattern with edge-case handling.

**curl/examples.sh:**

1. Replace inline help check with `parse_common_args "$@"` + `set -- "${REMAINING_ARGS[@]+${REMAINING_ARGS[@]}}"`.
2. Add `confirm_execute "${1:-}"` between require_target and safety_banner.
3. Convert 9 of 10 examples to run_or_show. Example 9 has a complex format string with embedded single quotes -- keep as info+echo to preserve exact output fidelity. Read the actual script to identify which example this is.
4. Guard interactive demo with EXECUTE_MODE. The curl demo has a pipe (`curl -I -s "$TARGET" | head -10`) -- this stays inside the demo section as a regular command, not as run_or_show (pipes are shell structure, not command arguments).

**traceroute/examples.sh:**

1. Replace inline help check with `parse_common_args "$@"` + `set -- "${REMAINING_ARGS[@]+${REMAINING_ARGS[@]}}"`.
2. Add `confirm_execute "${1:-}"` between require_target and safety_banner.
3. Convert examples 1-4 to run_or_show (simple traceroute commands with $TARGET).
4. Example 5 (TCP traceroute) is platform-conditional. Convert using run_or_show inside each branch:
   ```bash
   if [[ "$(uname -s)" == "Darwin" ]]; then
       run_or_show "5) TCP traceroute -- bypasses firewalls (requires sudo)" \
           sudo traceroute -P tcp "$TARGET"
   else
       run_or_show "5) TCP traceroute -- bypasses firewalls (requires sudo)" \
           sudo traceroute -T "$TARGET"
   fi
   ```
5. Examples 6-10 use `mtr` which may not be installed. Keep these as info+echo since:
   - mtr may not be available (the script checks `check_cmd mtr`)
   - Examples 7-10 have extra annotation lines ("Note: requires sudo")
   - Executing mtr commands when mtr is not installed would error in -x mode
6. Guard interactive demo with EXECUTE_MODE.
  </action>
  <verify>
For each of the 2 scripts:
1. `bash scripts/<tool>/examples.sh --help` -- exits 0
2. `echo "" | bash scripts/<tool>/examples.sh -x test.target 2>&1` -- exits non-zero, mentions "interactive terminal"
3. Verify traceroute example 5 still has platform conditional
4. Verify traceroute examples 6-10 remain as info+echo (mtr commands)
5. Verify curl interactive demo pipe is inside EXECUTE_MODE guard
  </verify>
  <done>
curl and traceroute examples.sh migrated with edge cases preserved: curl pipe in demo, traceroute platform conditional, mtr examples as info+echo.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate netcat and foremost to dual-mode pattern</name>
  <files>
    scripts/netcat/examples.sh
    scripts/foremost/examples.sh
  </files>
  <action>
Apply the nmap migration pattern with special handling for variant logic and optional target.

**netcat/examples.sh:**

1. Replace inline help check with `parse_common_args "$@"` + `set -- "${REMAINING_ARGS[@]+${REMAINING_ARGS[@]}}"`.
2. Add `confirm_execute "${1:-}"` between require_target and safety_banner.
3. Convert examples 1, 2, 4, 5, 6 to run_or_show -- these are simple single commands using `$TARGET`:
   - Example 1: `nc -zv "$TARGET" 80`
   - Example 2: `nc -zv "$TARGET" 20-100`
   - Example 4: `nc -v "$TARGET" 80`
   - Example 5: `nc -u "$TARGET" 53`
   - Example 6: `nc -w 3 -zv "$TARGET" 80`
4. Keep examples 3, 7, 8, 9, 10 as info+echo patterns. These have variant-specific `if/case` statements (different commands per NC_VARIANT) and are inherently show-only (listeners, command execution, file transfer multi-step workflows). Do NOT convert these to run_or_show.
5. Guard interactive demo with EXECUTE_MODE.

**foremost/examples.sh:**

1. Replace inline help check with `parse_common_args "$@"` + `set -- "${REMAINING_ARGS[@]+${REMAINING_ARGS[@]}}"`.
2. foremost does NOT call `require_target` -- target is optional. The existing line `TARGET="${1:-}"` stays after parse_common_args. Add `confirm_execute "${1:-}"` before safety_banner (with the optional target).
3. Keep ALL 10 examples as info+echo. None use `$TARGET` -- they all use hardcoded `image.dd` filenames. Converting them to run_or_show would be meaningless (the commands would fail without the actual file).
4. Guard the interactive demo section with EXECUTE_MODE. The demo has two branches (target exists as file vs. no target) -- both stay inside the guard:
   ```bash
   if [[ "${EXECUTE_MODE:-show}" == "show" ]]; then
       [[ ! -t 0 ]] && exit 0
       if [[ -n "$TARGET" && -f "$TARGET" ]]; then
           read -rp "Run foremost on ${TARGET}?..." answer
           ...
       else
           read -rp "Show foremost version?..." answer
           ...
       fi
   fi
   ```
  </action>
  <verify>
1. `bash scripts/netcat/examples.sh --help` -- exits 0
2. `bash scripts/foremost/examples.sh --help` -- exits 0
3. `bash scripts/foremost/examples.sh` -- works without target (no error)
4. `echo "" | bash scripts/netcat/examples.sh -x test.target 2>&1` -- exits non-zero
5. `echo "" | bash scripts/foremost/examples.sh -x 2>&1` -- exits non-zero
6. Verify netcat examples 3, 7, 8, 9, 10 still have if/case variant logic
7. Verify foremost examples still use hardcoded `image.dd`
  </verify>
  <done>
netcat and foremost examples.sh migrated with variant-specific examples preserved as info+echo and optional target handling working correctly.
  </done>
</task>

</tasks>

<verification>
For all 4 scripts (curl, traceroute, netcat, foremost):
1. `--help` and `-h` both exit 0
2. Running with target produces educational output with numbered examples
3. `-x` with piped stdin exits non-zero
4. grep confirms `parse_common_args` and `confirm_execute` present
5. Netcat variant case statements preserved
6. Traceroute platform conditional preserved
7. Foremost runs without target argument
</verification>

<success_criteria>
All 4 edge-case target scripts accept dual-mode flags. Combined with Plan 01 and nmap, 12 of 17 scripts are migrated.
</success_criteria>

<output>
After completion, create `.planning/phases/15-examples-script-migration/15-02-SUMMARY.md`
</output>
