---
phase: 15-examples-script-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/dig/examples.sh
  - scripts/hping3/examples.sh
  - scripts/gobuster/examples.sh
  - scripts/ffuf/examples.sh
  - scripts/skipfish/examples.sh
  - scripts/nikto/examples.sh
  - scripts/sqlmap/examples.sh
autonomous: true

must_haves:
  truths:
    - "Running any of the 7 migrated scripts with --help prints usage and exits 0"
    - "Running any of the 7 migrated scripts with a target (no -x) produces identical educational output to pre-migration"
    - "Running any of the 7 migrated scripts with -x and piped stdin rejects with interactive terminal warning"
  artifacts:
    - path: "scripts/dig/examples.sh"
      provides: "dig dual-mode examples"
      contains: "parse_common_args"
    - path: "scripts/hping3/examples.sh"
      provides: "hping3 dual-mode examples"
      contains: "parse_common_args"
    - path: "scripts/gobuster/examples.sh"
      provides: "gobuster dual-mode examples"
      contains: "parse_common_args"
    - path: "scripts/ffuf/examples.sh"
      provides: "ffuf dual-mode examples"
      contains: "parse_common_args"
    - path: "scripts/skipfish/examples.sh"
      provides: "skipfish dual-mode examples"
      contains: "parse_common_args"
    - path: "scripts/nikto/examples.sh"
      provides: "nikto dual-mode examples"
      contains: "parse_common_args"
    - path: "scripts/sqlmap/examples.sh"
      provides: "sqlmap dual-mode examples"
      contains: "parse_common_args"
  key_links:
    - from: "each migrated script"
      to: "scripts/lib/args.sh"
      via: "parse_common_args call"
      pattern: "parse_common_args"
    - from: "each migrated script"
      to: "scripts/lib/output.sh"
      via: "run_or_show and confirm_execute calls"
      pattern: "run_or_show|confirm_execute"
---

<objective>
Migrate 7 simple target-required examples.sh scripts to the dual-mode pattern: dig, hping3, gobuster, ffuf, skipfish, nikto, sqlmap.

Purpose: These 7 scripts have clean patterns and are the most straightforward conversions. Getting them done first proves the pattern scales.
Output: 7 scripts accepting -h/-v/-q/-x flags with run_or_show for all eligible examples.
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-examples-script-migration/15-RESEARCH.md
@.planning/phases/14-argument-parsing-and-dual-mode-pattern/14-01-SUMMARY.md
@scripts/nmap/examples.sh (reference pattern -- already migrated)
@scripts/lib/args.sh
@scripts/lib/output.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate dig, hping3, gobuster, ffuf to dual-mode pattern</name>
  <files>
    scripts/dig/examples.sh
    scripts/hping3/examples.sh
    scripts/gobuster/examples.sh
    scripts/ffuf/examples.sh
  </files>
  <action>
Apply the proven nmap migration pattern to each of the 4 scripts. For each script:

1. **Replace inline help check** with `parse_common_args "$@"` + `set -- "${REMAINING_ARGS[@]+${REMAINING_ARGS[@]}}"`. Remove the line `[[ "${1:-}" =~ ^(-h|--help)$ ]] && show_help && exit 0`.

2. **Add confirm_execute** between require_target and safety_banner:
   ```
   confirm_execute "${1:-}"
   safety_banner
   ```

3. **Convert eligible examples** from the 3-line `info + echo + echo ""` pattern to single-line `run_or_show`:
   ```bash
   # BEFORE:
   info "1) Basic A record lookup"
   echo "   dig ${TARGET}"
   echo ""

   # AFTER:
   run_or_show "1) Basic A record lookup" \
       dig "$TARGET"
   ```
   Use proper shell quoting: `"$TARGET"` not `${TARGET}`. The run_or_show function handles both the info line and the echo formatting in show mode.

4. **Guard interactive demo** with EXECUTE_MODE check:
   ```bash
   if [[ "${EXECUTE_MODE:-show}" == "show" ]]; then
       [[ ! -t 0 ]] && exit 0
       read -rp "..." answer
       ...
   fi
   ```

**Per-script notes:**

- **dig**: All 10 examples convert to run_or_show. Example 9 (`dig -x 8.8.8.8`) is a static command -- keep as info+echo since it does not use $TARGET.
- **hping3**: All 10 examples use `sudo hping3 ... $TARGET` -- all convert to run_or_show. Note: hping3 has an extra `warn` line after `TARGET="$1"` -- preserve it. Any multi-line echo comment on example 8 stays as info+echo.
- **gobuster**: All 10 examples convert. The interactive demo has a wordlist existence check before running -- preserve it inside the EXECUTE_MODE guard.
- **ffuf**: All 10 examples convert. There is an extra `info "Note: ffuf..."` block before examples -- preserve it. The interactive demo has a wordlist check -- preserve inside EXECUTE_MODE guard.
  </action>
  <verify>
For each of the 4 scripts, run:
1. `bash scripts/<tool>/examples.sh --help` -- exits 0, shows "Usage:"
2. `bash scripts/<tool>/examples.sh -h` -- exits 0, shows "Usage:"
3. `echo "" | bash scripts/<tool>/examples.sh -x test.target 2>&1` -- exits non-zero, mentions "interactive terminal"
4. Verify each script contains `parse_common_args`, `run_or_show`, `confirm_execute`, and `EXECUTE_MODE`
  </verify>
  <done>
dig, hping3, gobuster, and ffuf examples.sh scripts all accept -h/-v/-q/-x flags, display educational output in show mode, and reject non-interactive execute mode.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate skipfish, nikto, sqlmap to dual-mode pattern</name>
  <files>
    scripts/skipfish/examples.sh
    scripts/nikto/examples.sh
    scripts/sqlmap/examples.sh
  </files>
  <action>
Apply the same nmap migration pattern to these 3 scripts. **Critical difference:** All three have `exit 0` inside their `show_help()` function -- this MUST be removed. `parse_common_args` handles the exit after calling show_help.

For each script, apply the same 4-step transformation as Task 1.

**Per-script notes:**

- **skipfish**: Remove `exit 0` from inside `show_help()`. Remove the line `[[ "${1:-}" =~ ^(-h|--help)$ ]] && show_help`. All 10 examples convert to run_or_show (all use $TARGET). Example 10 (`open skipfish-output/index.html`) is static -- keep as info+echo.

- **nikto**: Remove `exit 0` from inside `show_help()`. Remove the line `[[ "${1:-}" =~ ^(-h|--help)$ ]] && show_help`. Convert examples 1-5, 7, 8, 9 to run_or_show (8 of 10). Keep examples 6 and 10 as info+echo because they have multi-line comment annotations (`# 1=Files, 2=Misconfig...` and `# 1=Random URI, 2=Self-ref...`).

- **sqlmap**: Remove `exit 0` from inside `show_help()`. Remove the line `[[ "${1:-}" =~ ^(-h|--help)$ ]] && show_help`. Convert examples 1, 2, 3, 6, 7, 9, 10 to run_or_show. Keep examples 4, 5 as info+echo (they use placeholder `<database>` and `<table>` values). Keep example 8 as info+echo (has multi-line technique comment). Note: sqlmap examples use single-quoted `'${TARGET}?id=1'` syntax -- when converting to run_or_show, the command arguments should use proper quoting: `sqlmap -u "${TARGET}?id=1" --dbs`. The interactive demo section for sqlmap has warn/info lines but no read prompt -- still guard with EXECUTE_MODE.
  </action>
  <verify>
For each of the 3 scripts, run:
1. `bash scripts/<tool>/examples.sh --help` -- exits 0, shows "Usage:"
2. `bash scripts/<tool>/examples.sh -h` -- exits 0, shows "Usage:"
3. `echo "" | bash scripts/<tool>/examples.sh -x test.target 2>&1` -- exits non-zero, mentions "interactive terminal"
4. Verify `show_help()` in each file does NOT contain `exit 0`
5. Verify each script contains `parse_common_args`, `confirm_execute`, and `EXECUTE_MODE`
  </verify>
  <done>
skipfish, nikto, and sqlmap examples.sh scripts migrated with exit 0 removed from show_help, flags working, run_or_show on eligible examples, and placeholder/annotated examples preserved as info+echo.
  </done>
</task>

</tasks>

<verification>
For all 7 scripts (dig, hping3, gobuster, ffuf, skipfish, nikto, sqlmap):
1. `--help` and `-h` both exit 0 and print "Usage:"
2. Running with a target (no -x) produces educational output containing example numbers
3. `-x` with piped stdin exits non-zero with "interactive terminal" warning
4. grep confirms `parse_common_args`, `run_or_show`, `confirm_execute` present in each file
5. No `exit 0` inside `show_help()` in nikto, sqlmap, skipfish
</verification>

<success_criteria>
All 7 simple target-required scripts accept dual-mode flags and produce backward-compatible output. Combined with nmap (already done), 8 of 17 scripts are migrated.
</success_criteria>

<output>
After completion, create `.planning/phases/15-examples-script-migration/15-01-SUMMARY.md`
</output>
