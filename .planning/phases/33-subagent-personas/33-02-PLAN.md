---
phase: 33-subagent-personas
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/agents/defender.md
  - .claude/agents/analyst.md
  - .claude/skills/defender/SKILL.md
  - .claude/skills/analyst/SKILL.md
autonomous: true
requirements:
  - AGNT-02
  - AGNT-03

must_haves:
  truths:
    - "User can invoke /defender and it delegates to the defender subagent for defensive analysis"
    - "Defender subagent is read-only (no Bash, no Write) and cannot execute commands"
    - "User can invoke /analyst and it delegates to the analyst subagent for report synthesis"
    - "Analyst subagent can write report files but cannot execute commands"
    - "Both agents preload pentest-conventions for project context"
    - "Both skill shims use disable-model-invocation: true"
  artifacts:
    - path: ".claude/agents/defender.md"
      provides: "Defensive security analysis subagent persona"
      contains: "tools: Read, Grep, Glob"
    - path: ".claude/agents/analyst.md"
      provides: "Security analysis and report synthesis subagent persona"
      contains: "tools: Read, Grep, Glob, Write"
    - path: ".claude/skills/defender/SKILL.md"
      provides: "Thin skill shim for /defender slash command"
      contains: "context: fork"
    - path: ".claude/skills/analyst/SKILL.md"
      provides: "Thin skill shim for /analyst slash command"
      contains: "context: fork"
  key_links:
    - from: ".claude/skills/defender/SKILL.md"
      to: ".claude/agents/defender.md"
      via: "agent: defender frontmatter field"
      pattern: "agent: defender"
    - from: ".claude/skills/analyst/SKILL.md"
      to: ".claude/agents/analyst.md"
      via: "agent: analyst frontmatter field"
      pattern: "agent: analyst"
    - from: ".claude/agents/analyst.md"
      to: ".claude/skills/report/SKILL.md"
      via: "skills frontmatter preloading"
      pattern: "skills:"
---

<objective>
Create the defender and analyst subagents with their /defender and /analyst skill shims for defensive analysis and report synthesis.

Purpose: The defender and analyst are simpler read-only agents that follow the same pattern validated by the pentester agent in 33-01. Both analyze findings rather than execute tools, with the analyst additionally able to write report files.
Output: defender.md and analyst.md agent files, /defender and /analyst SKILL.md shims
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-subagent-personas/33-RESEARCH.md
@.claude/skills/report/SKILL.md
@.claude/skills/pentest-conventions/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create defender agent and /defender skill shim</name>
  <files>.claude/agents/defender.md, .claude/skills/defender/SKILL.md</files>
  <action>
Create `.claude/agents/defender.md` with the following structure:

**YAML frontmatter**:
- `name: defender`
- `description: Defensive security analyst. Use when analyzing pentesting findings from a defensive perspective, recommending mitigations, or assessing risk posture. Use proactively after scanning or pentesting completes.`
- `tools: Read, Grep, Glob` (NO Bash -- read-only analysis only)
- `model: inherit`
- `memory: project`
- `skills:` list containing: `pentest-conventions`

**Markdown body** (system prompt for the defender persona):

The persona is a senior defensive security analyst who reviews penetration testing findings. The body must include:

1. Role statement -- defensive security analyst providing actionable remediation guidance
2. Explicit statement: "You are analysis-only. You cannot execute commands or modify files. Analyze the findings provided to you and deliver defensive recommendations."
3. When invoked with findings, the agent should: categorize by attack vector, assess exploitability and impact, prioritize by risk (likelihood x impact), provide specific remediation steps, identify systemic issues (patterns across findings), recommend detection and monitoring improvements
4. Analysis Framework section -- for each finding provide:
   - Attack Vector: how the vulnerability is exploited
   - Impact: what an attacker gains
   - Exploitability: ease of exploitation
   - Remediation: specific fix with priority (immediate/short-term/long-term)
   - Detection: how to detect exploitation attempts (SIEM rules, log patterns)
5. Defensive Posture Assessment section:
   - Overall security posture rating (Critical/Poor/Fair/Good)
   - Top 3 systemic issues requiring architectural changes
   - Quick wins (high-impact, low-effort fixes)
   - Recommended security monitoring improvements
6. Memory instruction: update agent memory with recurring vulnerability patterns and effective remediation strategies

Use the research code examples as reference. Keep the file under 55 lines total.

Then create `.claude/skills/defender/SKILL.md` with:

**YAML frontmatter**:
- `name: defender`
- `description: Invoke defender subagent for defensive analysis of pentesting findings`
- `context: fork`
- `agent: defender`
- `disable-model-invocation: true`
- `argument-hint: "[findings-summary-or-file]"`

**Skill body**:
- H2 "Analysis Request"
- "Findings to analyze: $ARGUMENTS"
- Instruct the agent to analyze provided findings from a defensive perspective, assess risk, recommend remediation, and identify systemic issues
- If no findings were provided, review available scan results from the current project directory

Keep the skill shim under 15 lines of body content.

Do NOT add Bash or Write to the defender's tools list. The defender must be read-only.
  </action>
  <verify>
- `head -15 .claude/agents/defender.md` shows YAML with tools: Read, Grep, Glob (no Bash)
- `head -15 .claude/skills/defender/SKILL.md` shows context: fork + agent: defender
- `grep "Bash" .claude/agents/defender.md` returns empty (no Bash access)
- `grep "disable-model-invocation: true" .claude/skills/defender/SKILL.md` returns 1 match
  </verify>
  <done>
defender.md agent file exists with read-only tools (Read, Grep, Glob), memory: project, and pentest-conventions preloaded. /defender SKILL.md exists with context: fork, agent: defender, and disable-model-invocation: true.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create analyst agent and /analyst skill shim</name>
  <files>.claude/agents/analyst.md, .claude/skills/analyst/SKILL.md</files>
  <action>
Create `.claude/agents/analyst.md` with the following structure:

**YAML frontmatter**:
- `name: analyst`
- `description: Security analysis specialist. Use when synthesizing results across multiple scans into structured reports, correlating findings, or producing engagement deliverables. Use proactively after multiple scans complete.`
- `tools: Read, Grep, Glob, Write` (Write for report output, but NO Bash)
- `model: inherit`
- `memory: project`
- `skills:` list containing: `pentest-conventions`, `report`

**Markdown body** (system prompt for the analyst persona):

The persona is a senior security analyst who synthesizes penetration testing results into structured reports. The body must include:

1. Role statement -- security analyst synthesizing results into structured analysis reports and engagement deliverables
2. When invoked with scan results or a reporting task, the agent should: correlate findings across all provided scan results, identify attack chains, de-duplicate overlapping findings from different tools, produce structured report following the preloaded report skill template, include executive summary, technical details, and remediation roadmap
3. Report Structure section -- follow the report skill template. For each finding include:
   - Finding ID (sequential: F-001, F-002, etc.)
   - Title, Severity, CVSS Score (if applicable)
   - Description, Evidence, Affected Systems, Remediation
4. Cross-Scan Correlation section:
   - When multiple tools report related findings, merge into single finding with evidence from all sources
   - Note which tools confirmed the finding (increases confidence)
   - Identify attack chains: vulnerability A + vulnerability B = escalated impact
5. Output section:
   - Write the report to `report-YYYY-MM-DD.md` in the project root using today's date
   - Also provide an inline summary showing finding counts by severity
6. Memory instruction: update agent memory with report patterns and cross-session findings

Use the research code examples as reference. Keep the file under 55 lines total.

Then create `.claude/skills/analyst/SKILL.md` with:

**YAML frontmatter**:
- `name: analyst`
- `description: Invoke analyst subagent for structured report synthesis across multiple scans`
- `context: fork`
- `agent: analyst`
- `disable-model-invocation: true`
- `argument-hint: "[report-title]"`

**Skill body**:
- H2 "Report Task"
- "Report title or task: $ARGUMENTS"
- Instruct the agent to synthesize available scan results into a structured security analysis report, correlate findings, and produce a professional deliverable
- If no title was provided, use 'Security Assessment Report' with today's date

Keep the skill shim under 15 lines of body content.

Do NOT add Bash to the analyst's tools list. The analyst writes reports but does not execute commands.
  </action>
  <verify>
- `head -15 .claude/agents/analyst.md` shows YAML with tools: Read, Grep, Glob, Write (no Bash)
- `head -15 .claude/skills/analyst/SKILL.md` shows context: fork + agent: analyst
- `grep "Bash" .claude/agents/analyst.md` returns empty (no Bash access)
- `grep "disable-model-invocation: true" .claude/skills/analyst/SKILL.md` returns 1 match
- `grep -c "report" .claude/agents/analyst.md` confirms report skill is in the skills list
  </verify>
  <done>
analyst.md agent file exists with tools: Read, Grep, Glob, Write; memory: project; and pentest-conventions + report preloaded. /analyst SKILL.md exists with context: fork, agent: analyst, and disable-model-invocation: true.
  </done>
</task>

</tasks>

<verification>
1. `.claude/agents/defender.md` exists with tools: Read, Grep, Glob (no Bash, no Write)
2. `.claude/agents/analyst.md` exists with tools: Read, Grep, Glob, Write (no Bash)
3. `.claude/skills/defender/SKILL.md` exists with context: fork + agent: defender + disable-model-invocation: true
4. `.claude/skills/analyst/SKILL.md` exists with context: fork + agent: analyst + disable-model-invocation: true
5. Defender preloads 1 skill: pentest-conventions
6. Analyst preloads 2 skills: pentest-conventions, report
7. Both agents use model: inherit and memory: project
8. Neither agent has Bash in tools list (enforced read-only / write-only)
9. No `context: fork` appears in either agent file
10. Both skill shims pass $ARGUMENTS to their respective agents
</verification>

<success_criteria>
- /defender skill shim delegates to defender agent via context: fork + agent: defender
- Defender agent is strictly read-only (Read, Grep, Glob only)
- /analyst skill shim delegates to analyst agent via context: fork + agent: analyst
- Analyst agent can read and write (Read, Grep, Glob, Write) but cannot execute commands
- Both agents preload pentest-conventions; analyst additionally preloads report skill
- All files follow established codebase patterns
</success_criteria>

<output>
After completion, create `.planning/phases/33-subagent-personas/33-02-SUMMARY.md`
</output>
