---
phase: 33-subagent-personas
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/agents/pentester.md
  - .claude/skills/pentester/SKILL.md
  - .gitignore
autonomous: true
requirements:
  - AGNT-01

must_haves:
  truths:
    - "User can invoke /pentester and it delegates to the pentester subagent in an isolated context"
    - "Pentester subagent has Bash access and can execute wrapper scripts with -j -x flags"
    - "Pentester subagent starts with all 6 preloaded skills (pentest-conventions, recon, scan, fuzz, crack, sniff) as operational knowledge"
    - "Agent memory directory is gitignored to prevent committing sensitive engagement data"
  artifacts:
    - path: ".claude/agents/pentester.md"
      provides: "Offensive pentesting subagent persona with YAML frontmatter"
      contains: "tools: Read, Grep, Glob, Bash"
    - path: ".claude/skills/pentester/SKILL.md"
      provides: "Thin skill shim for /pentester slash command"
      contains: "context: fork"
    - path: ".gitignore"
      provides: "Gitignore entry for agent-memory directory"
      contains: "agent-memory"
  key_links:
    - from: ".claude/skills/pentester/SKILL.md"
      to: ".claude/agents/pentester.md"
      via: "agent: pentester frontmatter field"
      pattern: "agent: pentester"
    - from: ".claude/agents/pentester.md"
      to: ".claude/skills/pentest-conventions/SKILL.md"
      via: "skills frontmatter preloading"
      pattern: "skills:"
---

<objective>
Create the pentester subagent and its /pentester skill shim for multi-tool attack workflow orchestration with context isolation.

Purpose: The pentester is the most complex agent (preloads 6 skills, uses Bash, orchestrates multi-tool workflows). Building it first validates the full agent + skill shim + memory pattern before applying it to the simpler defender and analyst agents.
Output: pentester.md agent file, /pentester SKILL.md shim, .gitignore update for agent-memory
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-subagent-personas/33-RESEARCH.md
@.claude/skills/recon/SKILL.md
@.claude/skills/pentest-conventions/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create pentester agent file and /pentester skill shim</name>
  <files>.claude/agents/pentester.md, .claude/skills/pentester/SKILL.md</files>
  <action>
Create `.claude/agents/pentester.md` with the following structure:

**YAML frontmatter** (required fields):
- `name: pentester`
- `description: Offensive pentesting specialist. Use when orchestrating multi-tool attack workflows, conducting vulnerability assessments, or testing targets with multiple security tools in sequence. Use proactively after scope is defined.`
- `tools: Read, Grep, Glob, Bash`
- `model: inherit`
- `memory: project`
- `skills:` list containing: `pentest-conventions`, `recon`, `scan`, `fuzz`, `crack`, `sniff`

**Markdown body** (system prompt for the pentester persona):

The persona is a senior penetration tester conducting authorized security assessments. The body must include:

1. Role statement -- offensive security specialist conducting authorized tests
2. When invoked with a target, the agent should: verify target is in scope (read .pentest/scope.json), plan the engagement based on target type, execute appropriate workflows using preloaded skill instructions, adapt approach based on findings, provide structured summary
3. Execution Rules section:
   - Always use wrapper scripts with -j -x flags: `bash scripts/<tool>/<script>.sh <target> -j -x`
   - Never invoke raw security tools directly (nmap, nikto, etc.)
   - Reference preloaded workflow skills for step-by-step instructions
   - If a tool is not installed, skip that step and note it
   - Check scope before every tool execution
4. Workflow Selection section -- based on target type:
   - Network targets (IPs, domains): start with recon, then scan
   - Web applications (URLs): start with scan, then fuzz
   - Hash files: use crack workflow
   - Network interfaces or pcap files: use sniff workflow
   - Combine workflows as needed for comprehensive assessments
5. Output Style section:
   - Verbose, detailed output during execution
   - When complete: executive summary (2-3 sentences), findings by severity (Critical/High/Medium/Low), specific evidence, recommended next steps
   - Update agent memory with effective attack paths and tool combinations
6. Key anti-pattern warning: do NOT try to invoke /recon or /scan as slash commands. The skill content is preloaded as reference instructions -- read the instructions and execute the bash commands directly.

Use the research code examples at `.planning/phases/33-subagent-personas/33-RESEARCH.md` as the primary reference. Keep the file under 60 lines total (frontmatter + body).

Then create `.claude/skills/pentester/SKILL.md` with:

**YAML frontmatter**:
- `name: pentester`
- `description: Invoke pentester subagent for multi-tool attack workflow orchestration`
- `context: fork`
- `agent: pentester`
- `disable-model-invocation: true`
- `argument-hint: "<target-or-task>"`

**Skill body** (becomes the task prompt sent to the agent):
- H2 "Engagement"
- "Target or task: $ARGUMENTS"
- Instruct the agent to conduct a penetration test against the specified target using preloaded workflow skills
- If no target or task was provided, ask what to test

Keep the skill shim under 15 lines of body content. This is a thin wrapper -- the agent file has the real instructions.

Do NOT add `context: fork` to the agent file -- that is a skill-only field. Agents always run in isolated context by default (see research Pitfall 1).
  </action>
  <verify>
Verify both files exist and have correct structure:
- `head -20 .claude/agents/pentester.md` shows YAML frontmatter with name, tools, model, memory, skills fields
- `head -15 .claude/skills/pentester/SKILL.md` shows YAML frontmatter with context: fork and agent: pentester
- Confirm `grep -c "disable-model-invocation: true" .claude/skills/pentester/SKILL.md` returns 1
- Confirm `grep -c "memory: project" .claude/agents/pentester.md` returns 1
- Confirm the agent file contains all 6 skill names in the skills list
  </verify>
  <done>
pentester.md agent file exists in .claude/agents/ with tools: Read, Grep, Glob, Bash; model: inherit; memory: project; and 6 preloaded skills. /pentester SKILL.md exists in .claude/skills/pentester/ with context: fork, agent: pentester, and disable-model-invocation: true.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add agent-memory to .gitignore</name>
  <files>.gitignore</files>
  <action>
Append a new section to `.gitignore` for agent memory data:

```
# Claude agent memory (may contain sensitive engagement data)
.claude/agent-memory/
```

Place this after the existing "Pentest scope and audit data" section at the end of the file. This prevents `memory: project` data from being committed since pentesting agent memory may contain target-specific findings, attack paths, and engagement details.
  </action>
  <verify>
`grep "agent-memory" .gitignore` returns the gitignore entry. Confirm it matches `.claude/agent-memory/`.
  </verify>
  <done>
.gitignore contains entry for .claude/agent-memory/ directory, preventing sensitive agent memory data from being version controlled.
  </done>
</task>

</tasks>

<verification>
1. `.claude/agents/pentester.md` exists with correct YAML frontmatter (name, description, tools, model, memory, skills)
2. `.claude/skills/pentester/SKILL.md` exists with context: fork + agent: pentester + disable-model-invocation: true
3. Agent file preloads exactly 6 skills: pentest-conventions, recon, scan, fuzz, crack, sniff
4. Agent file has Bash in tools list (required for script execution)
5. Agent file uses model: inherit (respects user's model choice)
6. Skill shim passes $ARGUMENTS to the agent
7. `.gitignore` includes .claude/agent-memory/ entry
8. No `context: fork` appears in the agent file (agent anti-pattern)
</verification>

<success_criteria>
- /pentester skill shim delegates to pentester agent via context: fork + agent: pentester
- Pentester agent has full Bash access and 6 preloaded workflow/convention skills
- Agent memory directory is gitignored
- All files follow established codebase patterns (YAML frontmatter structure matches existing .claude/agents/ and .claude/skills/ files)
</success_criteria>

<output>
After completion, create `.planning/phases/33-subagent-personas/33-01-SUMMARY.md`
</output>
