---
phase: 02-core-networking-tools
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/dig/examples.sh
  - scripts/dig/query-dns-records.sh
  - scripts/dig/check-dns-propagation.sh
  - scripts/dig/attempt-zone-transfer.sh
  - scripts/check-tools.sh
  - Makefile
autonomous: true

must_haves:
  truths:
    - "Running bash scripts/dig/examples.sh example.com prints 10 numbered educational dig examples with explanations"
    - "Running bash scripts/dig/query-dns-records.sh prints educational examples for querying A, AAAA, MX, NS, TXT, SOA records"
    - "Running bash scripts/dig/check-dns-propagation.sh prints examples for comparing DNS responses across multiple public resolvers"
    - "Running bash scripts/dig/attempt-zone-transfer.sh prints examples for AXFR zone transfer attempts"
    - "make check detects dig as installed/missing alongside the existing 11 tools"
  artifacts:
    - path: "scripts/dig/examples.sh"
      provides: "10 educational dig examples following Pattern A"
      contains: "require_target"
    - path: "scripts/dig/query-dns-records.sh"
      provides: "DNS record type query use-case"
      contains: "require_cmd dig"
    - path: "scripts/dig/check-dns-propagation.sh"
      provides: "Multi-resolver DNS propagation check"
      contains: "8.8.8.8"
    - path: "scripts/dig/attempt-zone-transfer.sh"
      provides: "AXFR zone transfer use-case"
      contains: "axfr"
    - path: "scripts/check-tools.sh"
      provides: "dig detection with version display"
      contains: "[dig]="
    - path: "Makefile"
      provides: "dig and use-case make targets"
      contains: "scripts/dig/examples.sh"
  key_links:
    - from: "scripts/dig/examples.sh"
      to: "scripts/common.sh"
      via: "source directive"
      pattern: 'source "\$\(dirname "\$0"\)/\.\./common\.sh"'
    - from: "scripts/check-tools.sh"
      to: "dig"
      via: "TOOLS array entry and get_version case"
      pattern: "\\[dig\\]="
    - from: "Makefile"
      to: "scripts/dig/examples.sh"
      via: "make target"
      pattern: "bash scripts/dig/examples\\.sh"
---

<objective>
Create the dig tool directory with examples.sh (10 educational examples, Pattern A) and three use-case scripts (query-dns-records, check-dns-propagation, attempt-zone-transfer). Integrate dig into check-tools.sh and Makefile.

Purpose: First of three networking tools. dig teaches DNS querying -- fundamental for network reconnaissance and troubleshooting.
Output: 4 executable bash scripts in scripts/dig/, updated check-tools.sh and Makefile.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-networking-tools/02-RESEARCH.md
@scripts/common.sh
@scripts/nmap/examples.sh
@scripts/nmap/discover-live-hosts.sh
@scripts/check-tools.sh
@Makefile
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dig examples.sh and three use-case scripts</name>
  <files>
    scripts/dig/examples.sh
    scripts/dig/query-dns-records.sh
    scripts/dig/check-dns-propagation.sh
    scripts/dig/attempt-zone-transfer.sh
  </files>
  <action>
Create scripts/dig/ directory and four scripts following established patterns exactly.

**examples.sh** (Pattern A -- copy structure from scripts/nmap/examples.sh):
- Shebang: `#!/usr/bin/env bash`
- Comment: `# dig/examples.sh -- dig: DNS lookup and query tool`
- Source common.sh: `source "$(dirname "$0")/../common.sh"`
- show_help() with Usage, description, two examples (example.com, google.com)
- Help flag check: `[[ "${1:-}" =~ ^(-h|--help)$ ]] && show_help && exit 0`
- `require_cmd dig "apt install dnsutils (Debian/Ubuntu) | dnf install bind-utils (RHEL/Fedora) | brew install bind (macOS)"`
- `require_target "${1:-}"`
- `safety_banner`
- `TARGET="$1"`
- Header: `info "=== dig Examples ==="` and `info "Target: ${TARGET}"`
- 10 numbered examples from research: (1) Basic A record lookup, (2) Short output +short, (3) MX records, (4) AAAA IPv6, (5) TXT records, (6) Query specific DNS server @8.8.8.8, (7) ANY records +noall +answer, (8) Trace delegation +trace, (9) Reverse DNS -x 8.8.8.8, (10) SOA record
- Each example: `info "N) Title"` then `echo "   dig command"` then `echo ""`
- Interactive demo: `[[ ! -t 0 ]] && exit 0` then `read -rp "Run a quick A record lookup on ${TARGET} now? [y/N] "` then run `dig +short ${TARGET}`
- Make executable: chmod +x

**query-dns-records.sh** (Use-case pattern -- copy structure from scripts/nmap/discover-live-hosts.sh):
- Source common.sh, show_help with Usage/Description/Examples
- `require_cmd dig "..."` (same install hint as above)
- `TARGET="${1:-example.com}"` (sensible default, NOT require_target)
- safety_banner, header
- Educational context: "Why query different DNS record types?" explaining A, AAAA, MX, NS, TXT, SOA purposes
- 10 examples: (1) A record, (2) AAAA record, (3) MX records, (4) NS nameservers, (5) TXT records (SPF/DKIM), (6) SOA zone authority, (7) CNAME aliases, (8) ALL records, (9) Short output for scripting, (10) Specific DNS server query
- Interactive demo: `dig ${TARGET} A +short` (quick, safe)

**check-dns-propagation.sh** (Use-case pattern):
- Source common.sh, show_help, require_cmd dig
- `TARGET="${1:-example.com}"`
- safety_banner, header
- Educational context: "Why check DNS propagation?" explaining TTL, caching, multi-resolver comparison
- Define RESOLVERS array: Google (8.8.8.8, 8.8.4.4), Cloudflare (1.1.1.1, 1.0.0.1), OpenDNS (208.67.222.222), Quad9 (9.9.9.9)
- 10 examples: (1) Check A record across resolvers loop, (2) Check MX across resolvers, (3) Check NS records, (4) Check TXT/SPF records, (5) Check AAAA across resolvers, (6) Compare TTL values, (7) Check with +trace for delegation path, (8) Query specific resolver verbosely, (9) Compare SOA serial numbers, (10) Full propagation check script one-liner
- Interactive demo: loop through 3 resolvers (8.8.8.8, 1.1.1.1, 9.9.9.9) querying `dig @server ${TARGET} A +short`

**attempt-zone-transfer.sh** (Use-case pattern):
- Source common.sh, show_help, require_cmd dig
- `TARGET="${1:-example.com}"`
- safety_banner, header
- Educational context: "Why attempt zone transfers?" explaining AXFR, misconfigured DNS, reconnaissance
- 10 examples: (1) Find authoritative nameservers first (dig NS), (2) Attempt AXFR against first NS, (3) Attempt AXFR against all NS servers loop, (4) IXFR incremental transfer attempt, (5) Check for wildcard records, (6) Verbose transfer attempt, (7) Transfer with TCP explicitly, (8) Check SOA for serial number, (9) Query for common subdomains (www, mail, ftp, etc.), (10) Save zone transfer output to file
- Interactive demo: `dig ${TARGET} NS +short` (just shows nameservers, does not attempt transfer -- safe demo)

All four scripts must be chmod +x.
  </action>
  <verify>
Run each script with --help flag and verify it exits 0:
```
bash scripts/dig/examples.sh --help
bash scripts/dig/query-dns-records.sh --help
bash scripts/dig/check-dns-propagation.sh --help
bash scripts/dig/attempt-zone-transfer.sh --help
```
Run examples.sh with a target in non-interactive mode and count 10 numbered examples:
```
echo "" | bash scripts/dig/examples.sh example.com 2>&1 | grep -c "^\\[INFO\\].*[0-9]*)"
```
Expected: 10
  </verify>
  <done>
All four dig scripts exist, are executable, follow Pattern A / use-case pattern, print 10 numbered examples each, and exit cleanly with --help.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate dig into check-tools.sh and Makefile</name>
  <files>
    scripts/check-tools.sh
    Makefile
  </files>
  <action>
**check-tools.sh changes:**

1. Add dig to the TOOLS associative array:
   ```
   [dig]="apt install dnsutils (Debian/Ubuntu) | brew install bind (macOS)"
   ```

2. Add `dig` to the TOOL_ORDER array after `foremost`:
   ```
   TOOL_ORDER=(nmap tshark msfconsole aircrack-ng hashcat skipfish sqlmap hping3 john nikto foremost dig)
   ```

3. Add a `dig)` case to the `get_version()` function (dig -v outputs to stderr, not stdout):
   ```bash
   dig)
       dig -v 2>&1 | head -1
       ;;
   ```
   Place this case before the `*)` default case.

4. Update the `total` display and the "Install all missing" hint at the bottom if it lists tools -- but check first: the existing code uses the dynamic `${#TOOL_ORDER[@]}` count so the total updates automatically. The brew install hint at the bottom is hardcoded. Do NOT add dig/curl/nc to the brew install hint line yet (curl handles that separately, and these tools are usually pre-installed). Leave the brew hint as-is for now.

**Makefile changes:**

1. Add to the .PHONY line: `dig query-dns check-dns-prop zone-transfer`

2. Add tool runner target after the existing tool-specific runners section:
   ```makefile
   dig: ## Run dig examples (usage: make dig TARGET=<domain>)
   	@bash scripts/dig/examples.sh $(TARGET)
   ```

3. Add use-case targets in the use-case scripts section:
   ```makefile
   query-dns: ## Query DNS records (usage: make query-dns TARGET=<domain>)
   	@bash scripts/dig/query-dns-records.sh $(or $(TARGET),example.com)

   check-dns-prop: ## Check DNS propagation (usage: make check-dns-prop TARGET=<domain>)
   	@bash scripts/dig/check-dns-propagation.sh $(or $(TARGET),example.com)

   zone-transfer: ## Attempt DNS zone transfer (usage: make zone-transfer TARGET=<domain>)
   	@bash scripts/dig/attempt-zone-transfer.sh $(or $(TARGET),example.com)
   ```

IMPORTANT: Makefile recipes MUST use actual tab characters for indentation, not spaces. The @bash lines must start with a tab.
  </action>
  <verify>
```
make help 2>&1 | grep -E "dig|query-dns|check-dns-prop|zone-transfer"
```
Expected: 4 lines showing the new targets.

```
bash scripts/check-tools.sh 2>&1 | grep -i dig
```
Expected: Shows dig with version or NOT INSTALLED status.
  </verify>
  <done>
`make check` shows dig in the tool list. `make help` shows dig, query-dns, check-dns-prop, and zone-transfer targets. `make dig TARGET=example.com` runs dig examples.
  </done>
</task>

</tasks>

<verification>
1. All four dig scripts exist and are executable:
   `ls -la scripts/dig/*.sh`
2. Each script sources common.sh and follows Pattern A / use-case pattern
3. `bash scripts/dig/examples.sh example.com` prints 10 numbered examples (non-interactive)
4. `make check` includes dig in its output
5. `make help` shows dig, query-dns, check-dns-prop, zone-transfer
</verification>

<success_criteria>
- scripts/dig/examples.sh prints 10 numbered educational dig examples for a given target
- Three use-case scripts (query-dns-records, check-dns-propagation, attempt-zone-transfer) each print 10 numbered examples
- check-tools.sh detects dig and displays its version
- Makefile has working targets for dig and all three use-cases
- All scripts follow established patterns (source common.sh, show_help, safety_banner)
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-networking-tools/02-01-SUMMARY.md`
</output>
