---
phase: 16-use-case-script-migration
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/sqlmap/dump-database.sh
  - scripts/sqlmap/test-all-parameters.sh
  - scripts/sqlmap/bypass-waf.sh
  - scripts/netcat/scan-ports.sh
  - scripts/netcat/setup-listener.sh
  - scripts/netcat/transfer-files.sh
autonomous: true

must_haves:
  truths:
    - "Running any of the 6 migrated scripts with --help prints usage and exits 0"
    - "Running any of the 6 migrated scripts without -x produces identical educational output to pre-migration"
    - "Running any of the 6 migrated scripts with -x and piped stdin rejects with interactive terminal warning"
  artifacts:
    - path: "scripts/sqlmap/dump-database.sh"
      provides: "sqlmap database dumping dual-mode"
      contains: "parse_common_args"
    - path: "scripts/sqlmap/test-all-parameters.sh"
      provides: "sqlmap parameter testing dual-mode"
      contains: "parse_common_args"
    - path: "scripts/sqlmap/bypass-waf.sh"
      provides: "sqlmap WAF bypass dual-mode"
      contains: "parse_common_args"
    - path: "scripts/netcat/scan-ports.sh"
      provides: "netcat port scanning dual-mode"
      contains: "parse_common_args"
    - path: "scripts/netcat/setup-listener.sh"
      provides: "netcat listener setup dual-mode"
      contains: "parse_common_args"
    - path: "scripts/netcat/transfer-files.sh"
      provides: "netcat file transfer dual-mode"
      contains: "parse_common_args"
  key_links:
    - from: "each migrated script"
      to: "scripts/lib/args.sh"
      via: "parse_common_args call"
      pattern: "parse_common_args"
    - from: "each migrated script"
      to: "scripts/lib/output.sh"
      via: "run_or_show and confirm_execute calls"
      pattern: "run_or_show|confirm_execute"
---

<objective>
Migrate 6 sqlmap and netcat use-case scripts to the dual-mode pattern: dump-database, test-all-parameters, bypass-waf, scan-ports, setup-listener, transfer-files.

Purpose: Optional-target scripts (sqlmap with derived URL) and variant-specific scripts (netcat with NC_VARIANT case statements). Per Phase 15-02: variant-specific case/if examples are inherently show-only.
Output: 6 scripts accepting -h/-v/-q/-x flags with run_or_show where applicable.
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-use-case-script-migration/16-RESEARCH.md
@.planning/phases/15-examples-script-migration/15-01-SUMMARY.md
@.planning/phases/15-examples-script-migration/15-02-SUMMARY.md
@scripts/nmap/examples.sh (reference pattern -- already migrated)
@scripts/netcat/examples.sh (reference -- already migrated, has variant case statements)
@scripts/lib/args.sh
@scripts/lib/output.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate sqlmap/dump-database, sqlmap/test-all-parameters, sqlmap/bypass-waf</name>
  <files>
    scripts/sqlmap/dump-database.sh
    scripts/sqlmap/test-all-parameters.sh
    scripts/sqlmap/bypass-waf.sh
  </files>
  <action>
Apply the migration pattern. sqlmap scripts use optional TARGET with a derived URL variable: `URL="${TARGET:-'http://target/page.php?id=1'}"`. The URL is set AFTER require_cmd and BEFORE the examples.

Place `parse_common_args "$@"` + `set --` after show_help. Place `confirm_execute "${1:-}"` between URL setup and safety_banner.

**Per-script notes:**

- **dump-database.sh**: `TARGET="${1:-}"` (optional). `URL="${TARGET:-'http://target/page.php?id=1'}"`. All 10 examples use `${URL}`. Examples 2-5, 8 use hardcoded `-D dvwa -T users` table/column names -- these are DVWA-specific. However, they are still valid sqlmap commands that would work against any target with those tables. Decision: keep examples with hardcoded `-D dvwa` as info+echo (DVWA-specific, won't work against arbitrary targets). Convert examples 1, 6, 7, 9, 10 to run_or_show (generic sqlmap commands using `${URL}`). Total: 5 convertible. The interactive demo is a complex if/else with no `read -rp` -- it only prints instructions. Wrap in EXECUTE_MODE guard.

- **test-all-parameters.sh**: Read the script to determine exact examples. `TARGET="${1:-}"` (optional). `URL` derived. Most examples use generic sqlmap flags. Convert examples that use `${URL}` with generic flags. Keep examples using hardcoded filenames (`request.txt`, specific cookie values) as info+echo. Estimate ~7-8 convertible based on research.

- **bypass-waf.sh**: `TARGET="${1:-}"` (optional). `URL` derived. All 10 examples use `${URL}` with `--tamper` flags. These are all single sqlmap commands -- convert all that use `${URL}`. Example 10 is `sqlmap --list-tampers` (no URL) -- keep as info+echo. Convert examples 1-9 to run_or_show. Total: 9 convertible.

For sqlmap examples, use proper quoting: `sqlmap -u "$URL" --batch --dbs`. The `$URL` may contain `?` and `=` characters which are safe in double quotes.
  </action>
  <verify>
For each of the 3 scripts, run:
1. `bash scripts/sqlmap/dump-database.sh --help` -- exits 0, shows "Usage:"
2. `bash scripts/sqlmap/test-all-parameters.sh -h` -- exits 0
3. `echo "" | bash scripts/sqlmap/bypass-waf.sh -x 'http://localhost:8080/vuln.php?id=1' 2>&1` -- exits non-zero, mentions "interactive terminal"
4. Verify each script contains `parse_common_args`, `confirm_execute`, and `EXECUTE_MODE`
5. Verify `URL` variable derivation is preserved in all 3 scripts
  </verify>
  <done>
Three sqlmap use-case scripts accept dual-mode flags. dump-database has 5 run_or_show (DVWA-specific examples preserved as info+echo). bypass-waf has 9 run_or_show. URL derivation from optional TARGET preserved in all scripts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate netcat/scan-ports, netcat/setup-listener, netcat/transfer-files</name>
  <files>
    scripts/netcat/scan-ports.sh
    scripts/netcat/setup-listener.sh
    scripts/netcat/transfer-files.sh
  </files>
  <action>
Apply the migration pattern. All three scripts use `NC_VARIANT=$(detect_nc_variant)` which must stay AFTER `set --` and BEFORE the examples. Per Phase 15-02: variant-specific case/if examples are inherently show-only -- kept as info+echo.

**Per-script notes:**

- **scan-ports.sh**: Uses `TARGET="${1:-127.0.0.1}"` and `NC_VARIANT`. Examples 1-9 are simple `nc -zv ${TARGET} <port>` commands with NO variant-specific logic. Convert examples 1-6, 8 to run_or_show (7 total). Example 3 has `;` chaining two commands -- keep as info+echo. Example 7 is a for loop -- keep as info+echo. Example 9 uses `| grep` pipe -- single pipeline, convert to run_or_show (8 total). Example 10 is a for loop -- keep as info+echo. Total: 8 convertible.

- **setup-listener.sh**: Uses `PORT="${1:-4444}"` and `NC_VARIANT`. ALL 10 examples have variant-specific if/else or case statements. Per Phase 15-02 decision: variant-specific case/if logic is inherently show-only. Keep ALL 10 as info+echo. This is structural-only migration. Note: the variable is `PORT` not `TARGET`, but `confirm_execute "${1:-}"` still works.

- **transfer-files.sh**: Uses `TARGET="${1:-127.0.0.1}"` and `NC_VARIANT`. Has a `_listener_cmd()` helper function. ALL 10 examples are multi-step workflows (receiver + sender commands) with multiple echo lines each, and example 5 has a case statement. Keep ALL 10 as info+echo. This is structural-only migration.

For scan-ports.sh, examples use basic `nc -zv ${TARGET} <port>` which works across all variants. The `-z` and `-v` flags are universal. Use: `nc -zv "$TARGET" 80`.
  </action>
  <verify>
For each of the 3 scripts, run:
1. `bash scripts/netcat/scan-ports.sh --help` -- exits 0, shows "Usage:"
2. `bash scripts/netcat/setup-listener.sh -h` -- exits 0
3. `echo "" | bash scripts/netcat/transfer-files.sh -x 127.0.0.1 2>&1` -- exits non-zero, mentions "interactive terminal"
4. Verify each script contains `parse_common_args`, `confirm_execute`, and `EXECUTE_MODE`
5. Verify `NC_VARIANT=$(detect_nc_variant)` is preserved in all 3 scripts
6. Verify `_listener_cmd()` helper is preserved in transfer-files.sh
  </verify>
  <done>
Three netcat use-case scripts accept dual-mode flags. scan-ports has 8 run_or_show. setup-listener has 0 conversions (all variant-specific case/if blocks). transfer-files has 0 conversions (all multi-step receiver/sender workflows). NC_VARIANT detection preserved.
  </done>
</task>

</tasks>

<verification>
For all 6 scripts:
1. `--help` and `-h` both exit 0 and print "Usage:"
2. Running with a target (no -x) produces educational output containing numbered examples
3. `-x` with piped stdin exits non-zero with "interactive terminal" warning
4. grep confirms `parse_common_args`, `confirm_execute`, `EXECUTE_MODE` present in each file
5. NC_VARIANT detection preserved in all netcat scripts
6. URL derivation preserved in all sqlmap scripts
7. Variant-specific case/if examples preserved as info+echo in setup-listener and transfer-files
</verification>

<success_criteria>
All 6 sqlmap and netcat use-case scripts accept dual-mode flags with variant-specific and optional-target edge cases handled correctly.
</success_criteria>

<output>
After completion, create `.planning/phases/16-use-case-script-migration/16-05-SUMMARY.md`
</output>
