---
phase: 16-use-case-script-migration
plan: 08
type: execute
wave: 2
depends_on: ["16-01", "16-02", "16-03", "16-04", "16-05", "16-06", "16-07"]
files_modified:
  - tests/test-arg-parsing.sh
autonomous: true

must_haves:
  truths:
    - "All 46 use-case scripts pass --help exits-0 test"
    - "All 46 use-case scripts pass -x piped-stdin rejection test"
    - "Test suite runs without errors and reports pass/fail for each script"
  artifacts:
    - path: "tests/test-arg-parsing.sh"
      provides: "Extended test suite covering 46 use-case scripts + 17 examples.sh"
      contains: "USE_CASE_SCRIPTS"
  key_links:
    - from: "tests/test-arg-parsing.sh"
      to: "scripts/*/[use-case].sh"
      via: "loop over all use-case script paths"
      pattern: "scripts.*\\.sh"
---

<objective>
Extend the test suite to verify all 46 use-case scripts accept dual-mode flags correctly.

Purpose: Regression testing -- confirm that every migrated use-case script passes --help and -x rejection tests. This mirrors Phase 15-04 which extended tests from nmap-only to all 17 examples.sh scripts.
Output: Extended test-arg-parsing.sh with use-case script test section covering all 46 scripts.
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-use-case-script-migration/16-RESEARCH.md
@.planning/phases/15-examples-script-migration/15-04-SUMMARY.md
@tests/test-arg-parsing.sh
@scripts/lib/args.sh
@scripts/lib/output.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend test suite with use-case script verification for all 46 scripts</name>
  <files>
    tests/test-arg-parsing.sh
  </files>
  <action>
Read the existing test-arg-parsing.sh to understand the current structure. It has 84 tests covering 17 examples.sh scripts. Extend it with a new section for use-case scripts.

**Add a use-case script test section** that:

1. **Defines an array of all 46 use-case script paths:**
   ```bash
   USE_CASE_SCRIPTS=(
       scripts/nmap/discover-live-hosts.sh
       scripts/nmap/scan-web-vulnerabilities.sh
       scripts/nmap/identify-ports.sh
       scripts/hping3/test-firewall-rules.sh
       scripts/hping3/detect-firewall.sh
       scripts/dig/query-dns-records.sh
       scripts/dig/attempt-zone-transfer.sh
       scripts/dig/check-dns-propagation.sh
       scripts/curl/check-ssl-certificate.sh
       scripts/curl/debug-http-response.sh
       scripts/curl/test-http-endpoints.sh
       scripts/nikto/scan-specific-vulnerabilities.sh
       scripts/nikto/scan-multiple-hosts.sh
       scripts/nikto/scan-with-auth.sh
       scripts/skipfish/scan-authenticated-app.sh
       scripts/skipfish/quick-scan-web-app.sh
       scripts/ffuf/fuzz-parameters.sh
       scripts/gobuster/discover-directories.sh
       scripts/gobuster/enumerate-subdomains.sh
       scripts/traceroute/trace-network-path.sh
       scripts/traceroute/diagnose-latency.sh
       scripts/traceroute/compare-routes.sh
       scripts/sqlmap/dump-database.sh
       scripts/sqlmap/test-all-parameters.sh
       scripts/sqlmap/bypass-waf.sh
       scripts/netcat/scan-ports.sh
       scripts/netcat/setup-listener.sh
       scripts/netcat/transfer-files.sh
       scripts/foremost/analyze-forensic-image.sh
       scripts/foremost/carve-specific-filetypes.sh
       scripts/foremost/recover-deleted-files.sh
       scripts/tshark/capture-http-credentials.sh
       scripts/tshark/analyze-dns-queries.sh
       scripts/tshark/extract-files-from-capture.sh
       scripts/metasploit/generate-reverse-shell.sh
       scripts/metasploit/scan-network-services.sh
       scripts/metasploit/setup-listener.sh
       scripts/hashcat/crack-ntlm-hashes.sh
       scripts/hashcat/benchmark-gpu.sh
       scripts/hashcat/crack-web-hashes.sh
       scripts/john/crack-linux-passwords.sh
       scripts/john/crack-archive-passwords.sh
       scripts/john/identify-hash-type.sh
       scripts/aircrack-ng/capture-handshake.sh
       scripts/aircrack-ng/crack-wpa-handshake.sh
       scripts/aircrack-ng/analyze-wireless-networks.sh
   )
   ```

2. **Test 1: --help exits 0 for all use-case scripts.**
   Loop over USE_CASE_SCRIPTS. For each, run `bash "$script" --help` and check exit code is 0 and output contains "Usage:".

3. **Test 2: -x with piped stdin exits non-zero for all use-case scripts.**
   Loop over USE_CASE_SCRIPTS. For each, run `echo "" | bash "$script" -x 2>&1`. The script should exit non-zero. It may exit via confirm_execute (interactive terminal message) or via require_cmd (tool not installed) -- both are acceptable non-zero exits.

   For scripts that need a target argument to get past require_target, provide a dummy target. Use the same pattern as the existing examples.sh tests with TOOL_TARGETS mapping:
   - Scripts with optional target: no extra arg needed
   - Scripts with required target: pass `test.target` or `127.0.0.1`

   Define a USE_CASE_TARGETS associative array mapping script paths to their test target args.

4. **Test 3: Verify parse_common_args is present in all 46 scripts.**
   grep check for `parse_common_args` in each script.

Follow the existing test patterns: use `pass()`/`fail()` helper functions, increment TESTS/PASSED/FAILED counters, print section headers with `info`.

Per Phase 15-04 decision: skip gracefully for tools not installed (tool not installed exits non-zero which is acceptable for the -x rejection test).
  </action>
  <verify>
1. `bash tests/test-arg-parsing.sh` runs without errors
2. All 46 use-case script --help tests pass
3. All 46 use-case script -x rejection tests pass (or skip for missing tools)
4. All 46 use-case scripts have parse_common_args grep match
5. Total test count increased from 84 to ~84 + 138 = ~222 tests (46*3 new tests)
  </verify>
  <done>
Test suite extended with use-case script verification covering all 46 scripts. All tests pass. Combined with existing 84 tests, the full suite validates 63 scripts (17 examples.sh + 46 use-case).
  </done>
</task>

</tasks>

<verification>
1. `bash tests/test-arg-parsing.sh` completes with 0 failures
2. Test output shows sections for both examples.sh and use-case scripts
3. All 46 use-case scripts represented in test output
4. No regressions in existing 84 examples.sh tests
</verification>

<success_criteria>
Extended test suite validates all 46 use-case scripts pass --help, -x rejection, and parse_common_args presence checks. Zero test failures.
</success_criteria>

<output>
After completion, create `.planning/phases/16-use-case-script-migration/16-08-SUMMARY.md`
</output>
