---
phase: 16-use-case-script-migration
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/metasploit/generate-reverse-shell.sh
  - scripts/metasploit/scan-network-services.sh
  - scripts/metasploit/setup-listener.sh
  - scripts/hashcat/crack-ntlm-hashes.sh
  - scripts/hashcat/benchmark-gpu.sh
  - scripts/hashcat/crack-web-hashes.sh
  - scripts/john/crack-linux-passwords.sh
  - scripts/john/crack-archive-passwords.sh
  - scripts/john/identify-hash-type.sh
  - scripts/aircrack-ng/capture-handshake.sh
  - scripts/aircrack-ng/crack-wpa-handshake.sh
  - scripts/aircrack-ng/analyze-wireless-networks.sh
autonomous: true

must_haves:
  truths:
    - "Running any of the 12 migrated scripts with --help prints usage and exits 0"
    - "Running any of the 12 migrated scripts without -x produces identical educational output to pre-migration"
    - "Running any of the 12 migrated scripts with -x and piped stdin rejects with interactive terminal warning"
  artifacts:
    - path: "scripts/metasploit/generate-reverse-shell.sh"
      provides: "msfvenom payload generation dual-mode"
      contains: "parse_common_args"
    - path: "scripts/metasploit/scan-network-services.sh"
      provides: "metasploit service scanning dual-mode"
      contains: "parse_common_args"
    - path: "scripts/metasploit/setup-listener.sh"
      provides: "metasploit listener setup dual-mode"
      contains: "parse_common_args"
    - path: "scripts/hashcat/crack-ntlm-hashes.sh"
      provides: "hashcat NTLM cracking dual-mode"
      contains: "parse_common_args"
    - path: "scripts/hashcat/benchmark-gpu.sh"
      provides: "hashcat GPU benchmark dual-mode"
      contains: "parse_common_args"
    - path: "scripts/hashcat/crack-web-hashes.sh"
      provides: "hashcat web hash cracking dual-mode"
      contains: "parse_common_args"
    - path: "scripts/john/crack-linux-passwords.sh"
      provides: "john linux password cracking dual-mode"
      contains: "parse_common_args"
    - path: "scripts/john/crack-archive-passwords.sh"
      provides: "john archive password cracking dual-mode"
      contains: "parse_common_args"
    - path: "scripts/john/identify-hash-type.sh"
      provides: "john hash identification dual-mode"
      contains: "parse_common_args"
    - path: "scripts/aircrack-ng/capture-handshake.sh"
      provides: "aircrack-ng handshake capture dual-mode"
      contains: "parse_common_args"
    - path: "scripts/aircrack-ng/crack-wpa-handshake.sh"
      provides: "aircrack-ng WPA cracking dual-mode"
      contains: "parse_common_args"
    - path: "scripts/aircrack-ng/analyze-wireless-networks.sh"
      provides: "aircrack-ng wireless analysis dual-mode"
      contains: "parse_common_args"
  key_links:
    - from: "each migrated script"
      to: "scripts/lib/args.sh"
      via: "parse_common_args call"
      pattern: "parse_common_args"
    - from: "each migrated script"
      to: "scripts/lib/output.sh"
      via: "confirm_execute calls"
      pattern: "confirm_execute"
---

<objective>
Migrate 12 static/no-target use-case scripts to the dual-mode pattern: metasploit (3), hashcat (3), john (3), aircrack-ng (3).

Purpose: These scripts have zero or near-zero run_or_show conversions -- all examples use hardcoded filenames, msfconsole one-liners, or Linux-only wireless commands. The migration is purely structural (parse_common_args + confirm_execute + EXECUTE_MODE guard). This is the most mechanical batch, following the Phase 15-03 no-target pattern exactly.
Output: 12 scripts accepting -h/-v/-q/-x flags. hashcat/benchmark-gpu is the only script with significant run_or_show conversions (~9).
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-use-case-script-migration/16-RESEARCH.md
@.planning/phases/15-examples-script-migration/15-03-SUMMARY.md
@scripts/nmap/examples.sh (reference pattern -- already migrated)
@scripts/hashcat/examples.sh (reference -- already migrated, no-target pattern)
@scripts/metasploit/examples.sh (reference -- already migrated, multi-positional args)
@scripts/lib/args.sh
@scripts/lib/output.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate metasploit/generate-reverse-shell, scan-network-services, setup-listener and hashcat/crack-ntlm-hashes, benchmark-gpu, crack-web-hashes</name>
  <files>
    scripts/metasploit/generate-reverse-shell.sh
    scripts/metasploit/scan-network-services.sh
    scripts/metasploit/setup-listener.sh
    scripts/hashcat/crack-ntlm-hashes.sh
    scripts/hashcat/benchmark-gpu.sh
    scripts/hashcat/crack-web-hashes.sh
  </files>
  <action>
Apply the structural migration to all 6 scripts. Most are zero-conversion (info+echo only).

**Metasploit scripts (multi-positional args):**

- **generate-reverse-shell.sh**: Uses `LHOST="${1:-$(ipconfig getifaddr en0 ...)}"` and `LPORT="${2:-4444}"`. Place `parse_common_args "$@"` + `set --` AFTER show_help, BEFORE require_cmd. LHOST/LPORT assignments must be AFTER `set --` (per research pitfall 3 -- auto-detection side effects). All 10 examples use `msfvenom ... -o file` which writes files -- 0 convertible. Use `confirm_execute "${1:-}"`.

- **scan-network-services.sh**: Uses `TARGET="${1:-localhost}"`. All 10 examples are `msfconsole -q -x "..."` one-liners. Per research: "keep as info+echo -- msfconsole takes 10-30s to start." 0 convertible.

- **setup-listener.sh**: Uses `LHOST="${1:-...}"` and `LPORT="${2:-4444}"`. Same multi-positional pattern as generate-reverse-shell. All 10 examples are `msfconsole -q -x "..."` one-liners -- 0 convertible.

**Hashcat scripts:**

- **crack-ntlm-hashes.sh**: Uses `HASHFILE="${1:-}"` (optional). Has `HFILE` and `WORDLIST` derived variables. All 10 examples use hardcoded `${HFILE}` + wordlist paths -- 0 convertible. Use `confirm_execute "${1:-}"`.

- **benchmark-gpu.sh**: NO target variable. All examples are `hashcat -b ...` benchmark commands. Examples 1-9 are simple single-flag benchmark commands with NO file arguments -- convert to run_or_show. Example 10 uses hardcoded `hashes.txt wordlist.txt` -- keep as info+echo. Total: 9 convertible. Use `confirm_execute` with no argument.

- **crack-web-hashes.sh**: Uses `HASHFILE="${1:-}"` (optional). Has `HFILE` and `WORDLIST` derived variables. All 10 examples use hardcoded `${HFILE}` + wordlist paths -- 0 convertible.

**john/identify-hash-type.sh special case:** This script calls `safety_banner "brew install john"` with an extra argument. Per research pitfall 6: remove the argument during migration. Change to just `safety_banner`.
  </action>
  <verify>
For each of the 6 scripts, run:
1. `bash scripts/metasploit/generate-reverse-shell.sh --help` -- exits 0, shows "Usage:"
2. `bash scripts/hashcat/benchmark-gpu.sh -h` -- exits 0
3. `echo "" | bash scripts/metasploit/scan-network-services.sh -x localhost 2>&1` -- exits non-zero (either "interactive terminal" or require_cmd failure for msfconsole)
4. Verify each script contains `parse_common_args`, `confirm_execute`, and `EXECUTE_MODE`
5. Verify hashcat/benchmark-gpu.sh contains `run_or_show` calls
6. Verify metasploit scripts do NOT contain `run_or_show` (all info+echo)
  </verify>
  <done>
Six scripts accept dual-mode flags. All metasploit scripts (0 conversions each), crack-ntlm-hashes (0), crack-web-hashes (0) are structural-only. benchmark-gpu has 9 run_or_show. LHOST/LPORT auto-detection preserved after set -- in multi-positional arg scripts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate john/crack-linux-passwords, crack-archive-passwords, identify-hash-type and aircrack-ng/capture-handshake, crack-wpa-handshake, analyze-wireless-networks</name>
  <files>
    scripts/john/crack-linux-passwords.sh
    scripts/john/crack-archive-passwords.sh
    scripts/john/identify-hash-type.sh
    scripts/aircrack-ng/capture-handshake.sh
    scripts/aircrack-ng/crack-wpa-handshake.sh
    scripts/aircrack-ng/analyze-wireless-networks.sh
  </files>
  <action>
Apply the structural migration to all 6 scripts. ALL are zero-conversion (info+echo only).

**John scripts:**

- **crack-linux-passwords.sh**: All 10 examples use hardcoded `unshadowed.txt`, `wordlist.txt` -- 0 convertible. Structural-only.

- **crack-archive-passwords.sh**: Uses `ARCHIVE="${1:-}"` (optional). All examples use hardcoded `protected.zip`, `rar.hash`, etc. -- 0 convertible. Structural-only.

- **identify-hash-type.sh**: Uses `HASH="${1:-}"` (optional). All 10 examples use hardcoded `hash.txt` -- 0 convertible. **Special cleanup:** Remove the extra argument from `safety_banner "brew install john"` -- change to just `safety_banner`. The interactive demo has a complex if/else for hash analysis vs tip display -- wrap entire block in EXECUTE_MODE guard.

**Aircrack-ng scripts:**

- **capture-handshake.sh**: Uses `INTERFACE="${1:-wlan0}"`. All 10 examples use `${INTERFACE}` + hardcoded BSSIDs/MACs. Linux-only `sudo` commands. 0 convertible (all reference-only on macOS, hardcoded MAC addresses).

- **crack-wpa-handshake.sh**: Uses `CAPFILE="${1:-}"` (optional). All 10 examples use hardcoded `capture.cap`, `rockyou.txt` -- 0 convertible.

- **analyze-wireless-networks.sh**: Uses `INTERFACE="${1:-wlan0}"`. All 10 examples use `${INTERFACE}mon` + Linux-only commands. 0 convertible.

All 6 scripts get the same 4-step transformation: parse_common_args + set -- + confirm_execute + EXECUTE_MODE guard. No run_or_show conversions needed.
  </action>
  <verify>
For each of the 6 scripts, run:
1. `bash scripts/john/identify-hash-type.sh --help` -- exits 0, shows "Usage:"
2. `bash scripts/aircrack-ng/capture-handshake.sh -h` -- exits 0
3. `bash scripts/john/crack-archive-passwords.sh --help` -- exits 0
4. Verify each script contains `parse_common_args`, `confirm_execute`, and `EXECUTE_MODE`
5. Verify john/identify-hash-type.sh does NOT have `safety_banner "brew install john"` (argument removed)
6. Verify 0 run_or_show calls in all 6 scripts (all info+echo)
  </verify>
  <done>
Six scripts accept dual-mode flags. All 60 examples across 6 scripts preserved as info+echo (hardcoded filenames, Linux-only commands, MAC addresses). john/identify-hash-type.sh safety_banner argument cleaned up.
  </done>
</task>

</tasks>

<verification>
For all 12 scripts:
1. `--help` and `-h` both exit 0 and print "Usage:"
2. Running without -x produces educational output containing numbered examples
3. `-x` with piped stdin exits non-zero with "interactive terminal" warning (or require_cmd for tools not installed)
4. grep confirms `parse_common_args`, `confirm_execute`, `EXECUTE_MODE` present in each file
5. Only hashcat/benchmark-gpu.sh contains `run_or_show` -- all other 11 scripts are info+echo only
6. john/identify-hash-type.sh safety_banner has no extra argument
7. metasploit multi-positional args (LHOST=$1, LPORT=$2) work after parse_common_args + set --
</verification>

<success_criteria>
All 12 metasploit, hashcat, john, and aircrack-ng use-case scripts accept dual-mode flags. The migration is structural-only for 11 of 12 scripts, with benchmark-gpu being the only one with run_or_show conversions.
</success_criteria>

<output>
After completion, create `.planning/phases/16-use-case-script-migration/16-07-SUMMARY.md`
</output>
