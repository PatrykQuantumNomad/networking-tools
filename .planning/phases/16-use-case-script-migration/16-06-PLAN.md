---
phase: 16-use-case-script-migration
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/foremost/analyze-forensic-image.sh
  - scripts/foremost/carve-specific-filetypes.sh
  - scripts/foremost/recover-deleted-files.sh
  - scripts/tshark/capture-http-credentials.sh
  - scripts/tshark/analyze-dns-queries.sh
  - scripts/tshark/extract-files-from-capture.sh
autonomous: true

must_haves:
  truths:
    - "Running any of the 6 migrated scripts with --help prints usage and exits 0"
    - "Running any of the 6 migrated scripts without -x produces identical educational output to pre-migration"
    - "Running any of the 6 migrated scripts with -x and piped stdin rejects with interactive terminal warning"
  artifacts:
    - path: "scripts/foremost/analyze-forensic-image.sh"
      provides: "foremost forensic analysis dual-mode"
      contains: "parse_common_args"
    - path: "scripts/foremost/carve-specific-filetypes.sh"
      provides: "foremost file carving dual-mode"
      contains: "parse_common_args"
    - path: "scripts/foremost/recover-deleted-files.sh"
      provides: "foremost file recovery dual-mode"
      contains: "parse_common_args"
    - path: "scripts/tshark/capture-http-credentials.sh"
      provides: "tshark HTTP credential capture dual-mode"
      contains: "parse_common_args"
    - path: "scripts/tshark/analyze-dns-queries.sh"
      provides: "tshark DNS analysis dual-mode"
      contains: "parse_common_args"
    - path: "scripts/tshark/extract-files-from-capture.sh"
      provides: "tshark file extraction dual-mode"
      contains: "parse_common_args"
  key_links:
    - from: "each migrated script"
      to: "scripts/lib/args.sh"
      via: "parse_common_args call"
      pattern: "parse_common_args"
    - from: "each migrated script"
      to: "scripts/lib/output.sh"
      via: "confirm_execute calls"
      pattern: "confirm_execute"
---

<objective>
Migrate 6 foremost and tshark use-case scripts to the dual-mode pattern: analyze-forensic-image, carve-specific-filetypes, recover-deleted-files, capture-http-credentials, analyze-dns-queries, extract-files-from-capture.

Purpose: Foremost scripts use all hardcoded filenames (0 conversions). tshark interface scripts have some convertible examples. Both groups are mostly structural-only migrations.
Output: 6 scripts accepting -h/-v/-q/-x flags with run_or_show where applicable.
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-use-case-script-migration/16-RESEARCH.md
@.planning/phases/15-examples-script-migration/15-02-SUMMARY.md
@.planning/phases/15-examples-script-migration/15-03-SUMMARY.md
@scripts/nmap/examples.sh (reference pattern -- already migrated)
@scripts/foremost/examples.sh (reference -- already migrated, optional target)
@scripts/lib/args.sh
@scripts/lib/output.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate foremost/analyze-forensic-image, foremost/carve-specific-filetypes, foremost/recover-deleted-files</name>
  <files>
    scripts/foremost/analyze-forensic-image.sh
    scripts/foremost/carve-specific-filetypes.sh
    scripts/foremost/recover-deleted-files.sh
  </files>
  <action>
Apply the migration pattern. All three foremost scripts use optional TARGET: `TARGET="${1:-}"`. Per Phase 15-02 pattern for foremost/examples.sh: optional target scripts call `confirm_execute "${1:-}"` (may be empty).

**For all three scripts:** ALL 10 examples in each script use hardcoded filenames (`evidence.dd`, `disk.img`, `usb_backup.dd`, `memdump.raw`, etc.). Per Phase 15-02 decision: "foremost uses all hardcoded image.dd filenames -- all 10 examples kept as info+echo." These are structural-only migrations (0 run_or_show conversions).

Apply the 4-step transformation:
1. Replace inline help check with `parse_common_args "$@"` + `set --`
2. Add `confirm_execute "${1:-}"` between variable setup and `safety_banner`
3. No run_or_show conversions (all info+echo)
4. Guard interactive demo with EXECUTE_MODE

**Per-script notes:**

- **analyze-forensic-image.sh**: Interactive demo is a simple read/foremost. Wrap in EXECUTE_MODE.
- **carve-specific-filetypes.sh**: Interactive demo has if/else for TARGET file existence. Wrap entire block in EXECUTE_MODE.
- **recover-deleted-files.sh**: Interactive demo has if/else for TARGET file existence. Wrap entire block in EXECUTE_MODE.
  </action>
  <verify>
For each of the 3 scripts, run:
1. `bash scripts/foremost/analyze-forensic-image.sh --help` -- exits 0, shows "Usage:"
2. `bash scripts/foremost/carve-specific-filetypes.sh -h` -- exits 0
3. `echo "" | bash scripts/foremost/recover-deleted-files.sh -x 2>&1` -- exits non-zero, mentions "interactive terminal"
4. Verify each script contains `parse_common_args`, `confirm_execute`, and `EXECUTE_MODE`
5. Verify 0 run_or_show calls in any foremost script (all examples are info+echo)
  </verify>
  <done>
Three foremost use-case scripts accept dual-mode flags. All 30 examples preserved as info+echo (all hardcoded filenames). Interactive demos wrapped in EXECUTE_MODE guards.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate tshark/capture-http-credentials, tshark/analyze-dns-queries, tshark/extract-files-from-capture</name>
  <files>
    scripts/tshark/capture-http-credentials.sh
    scripts/tshark/analyze-dns-queries.sh
    scripts/tshark/extract-files-from-capture.sh
  </files>
  <action>
Apply the migration pattern. tshark use-case scripts use `TARGET` as a network INTERFACE name (e.g., `en0`), not a hostname. Per research: "convert to run_or_show for consistency (the confirm_execute gate and -x requirement already provide sufficient safety). However, examples using capture.pcap (file-based, no $TARGET) stay as info+echo."

**Per-script notes:**

- **capture-http-credentials.sh**: `TARGET="${1:-en0}"` (interface). Examples using `${TARGET}` as interface are `sudo tshark -i ${TARGET} ...` commands. Convert examples that use `${TARGET}` to run_or_show. Example 4 uses hardcoded `lo0` -- keep as info+echo. Example 7 uses `capture.pcap` -- keep as info+echo. Read the script to count exactly, but estimate ~8 convertible. Use: `sudo tshark -i "$TARGET" -Y 'http.request.method==POST' ...`.

- **analyze-dns-queries.sh**: `TARGET="${1:-en0}"` (interface). Examples using `${TARGET}` convert to run_or_show. Examples using `capture.pcap` stay as info+echo. Estimate ~7 convertible per research.

- **extract-files-from-capture.sh**: `TARGET` is a file path. ALL 10 examples use hardcoded `capture.pcap` or `traffic.pcap` filenames. Per research: "0 convertible." Keep all as info+echo. Structural-only migration.

For tshark interface examples, the `sudo` prefix is part of the command: `run_or_show "description" sudo tshark -i "$TARGET" ...`.
  </action>
  <verify>
For each of the 3 scripts, run:
1. `bash scripts/tshark/capture-http-credentials.sh --help` -- exits 0, shows "Usage:"
2. `bash scripts/tshark/analyze-dns-queries.sh -h` -- exits 0
3. `echo "" | bash scripts/tshark/extract-files-from-capture.sh -x 2>&1` -- exits non-zero, mentions "interactive terminal"
4. Verify each script contains `parse_common_args`, `confirm_execute`, and `EXECUTE_MODE`
5. Verify extract-files-from-capture.sh has 0 run_or_show calls
  </verify>
  <done>
Three tshark use-case scripts accept dual-mode flags. capture-http-credentials and analyze-dns-queries have ~7-8 run_or_show each (file-based examples preserved as info+echo). extract-files-from-capture has 0 conversions (all hardcoded capture.pcap filenames).
  </done>
</task>

</tasks>

<verification>
For all 6 scripts:
1. `--help` and `-h` both exit 0 and print "Usage:"
2. Running with a target (no -x) produces educational output containing numbered examples
3. `-x` with piped stdin exits non-zero with "interactive terminal" warning
4. grep confirms `parse_common_args`, `confirm_execute`, `EXECUTE_MODE` present in each file
5. All foremost scripts have 0 run_or_show (all hardcoded filenames)
6. tshark/extract-files-from-capture.sh has 0 run_or_show (all hardcoded filenames)
7. tshark interface scripts use `sudo tshark -i "$TARGET"` in run_or_show
</verification>

<success_criteria>
All 6 foremost and tshark use-case scripts accept dual-mode flags with optional target and interface patterns handled correctly.
</success_criteria>

<output>
After completion, create `.planning/phases/16-use-case-script-migration/16-06-SUMMARY.md`
</output>
