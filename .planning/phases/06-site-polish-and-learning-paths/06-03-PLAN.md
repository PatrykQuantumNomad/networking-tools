---
phase: 06-site-polish-and-learning-paths
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - scripts/check-docs-completeness.sh
  - .github/workflows/deploy-site.yml
autonomous: true

must_haves:
  truths:
    - "CI fails the build if any scripts/*/examples.sh lacks a corresponding docs page"
    - "CI passes when all tool scripts have documentation pages"
    - "The validation script handles both .md and .mdx file extensions"
  artifacts:
    - path: "scripts/check-docs-completeness.sh"
      provides: "Docs completeness validation script"
      contains: "examples.sh"
    - path: ".github/workflows/deploy-site.yml"
      provides: "CI workflow with docs validation step"
      contains: "check-docs-completeness"
  key_links:
    - from: ".github/workflows/deploy-site.yml"
      to: "scripts/check-docs-completeness.sh"
      via: "bash invocation in CI step"
      pattern: "bash scripts/check-docs-completeness.sh"
    - from: "scripts/check-docs-completeness.sh"
      to: "site/src/content/docs/tools/"
      via: "file existence check"
      pattern: "DOCS_DIR.*site/src/content/docs/tools"
---

<objective>
Create a CI validation script that verifies every tool script has a corresponding documentation page, and integrate it into the deploy workflow.

Purpose: Prevents documentation drift (PITFALL-5) -- new tool scripts without docs pages will fail the CI build.
Output: Validation script + updated CI workflow.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-site-polish-and-learning-paths/06-RESEARCH.md
@.github/workflows/deploy-site.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docs completeness validation script</name>
  <files>scripts/check-docs-completeness.sh</files>
  <action>
    Create `scripts/check-docs-completeness.sh` -- a bash script that validates every `scripts/*/examples.sh` has a corresponding documentation page at `site/src/content/docs/tools/<tool>.{md,mdx}`.

    Script requirements:
    - Shebang: `#!/usr/bin/env bash`
    - Use `set -euo pipefail`
    - Define SCRIPTS_DIR="scripts" and DOCS_DIR="site/src/content/docs/tools"
    - Loop over every `$SCRIPTS_DIR/*/examples.sh` file
    - For each, extract the tool name from the directory name (e.g., `scripts/nmap/examples.sh` -> `nmap`)
    - Check if either `$DOCS_DIR/${tool_name}.md` or `$DOCS_DIR/${tool_name}.mdx` exists
    - If neither exists, print an ERROR line with the missing mapping and increment error count
    - At the end: if errors > 0, print count and exit 1. Otherwise print OK with total tool count and exit 0.
    - Skip the `diagnostics` directory if it appears (it has no examples.sh, but guard against future additions)

    Follow the exact pattern from the research Example 3:

    ```bash
    #!/usr/bin/env bash
    # check-docs-completeness.sh -- Verify every tool script has a docs page
    set -euo pipefail

    SCRIPTS_DIR="scripts"
    DOCS_DIR="site/src/content/docs/tools"
    errors=0

    for examples_sh in "$SCRIPTS_DIR"/*/examples.sh; do
      tool_dir=$(dirname "$examples_sh")
      tool_name=$(basename "$tool_dir")

      if [[ ! -f "$DOCS_DIR/${tool_name}.md" ]] && [[ ! -f "$DOCS_DIR/${tool_name}.mdx" ]]; then
        echo "ERROR: No docs page for scripts/${tool_name}/examples.sh"
        echo "  Expected: $DOCS_DIR/${tool_name}.md or $DOCS_DIR/${tool_name}.mdx"
        ((errors++))
      fi
    done

    if [[ $errors -gt 0 ]]; then
      echo ""
      echo "FAILED: $errors tool(s) missing documentation pages"
      exit 1
    else
      echo "OK: All $(ls "$SCRIPTS_DIR"/*/examples.sh | wc -l | tr -d ' ') tools have documentation pages"
    fi
    ```

    Make the script executable: `chmod +x scripts/check-docs-completeness.sh`
  </action>
  <verify>
    Run `bash scripts/check-docs-completeness.sh` from the project root. It should print "OK: All 15 tools have documentation pages" and exit 0. Verify it catches missing pages by temporarily testing: `mv site/src/content/docs/tools/nmap.mdx site/src/content/docs/tools/nmap.mdx.bak && bash scripts/check-docs-completeness.sh; mv site/src/content/docs/tools/nmap.mdx.bak site/src/content/docs/tools/nmap.mdx` -- the first run should exit 1 with an error about nmap.
  </verify>
  <done>The script correctly identifies all 15 tool scripts, validates their docs pages exist (checking both .md and .mdx), and exits 0 when all pass or 1 when any are missing.</done>
</task>

<task type="auto">
  <name>Task 2: Add docs validation step to deploy workflow</name>
  <files>.github/workflows/deploy-site.yml</files>
  <action>
    Add a "Validate docs completeness" step to the existing `.github/workflows/deploy-site.yml` workflow.

    Insert the new step in the `build` job, AFTER the "Checkout" step and BEFORE the "Build Astro site" step. This ensures the build fails fast if documentation is missing, before spending time on the Astro build.

    The step to add:
    ```yaml
    - name: Validate docs completeness
      run: bash scripts/check-docs-completeness.sh
    ```

    The final build job steps should be:
    1. Checkout
    2. Validate docs completeness (NEW)
    3. Build Astro site

    Do NOT modify any other part of the workflow (permissions, concurrency, deploy job, etc.).
  </action>
  <verify>
    Read the updated `.github/workflows/deploy-site.yml` and verify the "Validate docs completeness" step appears between Checkout and Build. Run the workflow validation: `cd /Users/patrykattc/work/git/networking-tools && cat .github/workflows/deploy-site.yml` to visually confirm step order.
  </verify>
  <done>The deploy workflow now validates docs completeness before building. Missing documentation pages will fail the CI build before the Astro build step runs.</done>
</task>

</tasks>

<verification>
1. `bash scripts/check-docs-completeness.sh` exits 0 with "OK: All 15 tools have documentation pages"
2. The script exits 1 when a docs page is missing (tested by temporarily renaming a file)
3. `.github/workflows/deploy-site.yml` has 3 steps in the build job: Checkout, Validate docs completeness, Build Astro site
4. `make site-build` still works (no interference from the new script)
</verification>

<success_criteria>
- CI validation script exists and correctly maps 15 tool scripts to docs pages
- Script handles both .md and .mdx extensions
- Deploy workflow runs validation before Astro build
- Script fails clearly with actionable error messages when docs are missing
</success_criteria>

<output>
After completion, create `.planning/phases/06-site-polish-and-learning-paths/06-03-SUMMARY.md`
</output>
