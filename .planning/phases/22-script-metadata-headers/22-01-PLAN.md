---
phase: 22-script-metadata-headers
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/lib/args.sh
  - scripts/lib/cleanup.sh
  - scripts/lib/colors.sh
  - scripts/lib/diagnostic.sh
  - scripts/lib/logging.sh
  - scripts/lib/nc_detect.sh
  - scripts/lib/output.sh
  - scripts/lib/strict.sh
  - scripts/lib/validation.sh
  - scripts/common.sh
  - scripts/check-tools.sh
  - scripts/check-docs-completeness.sh
  - scripts/diagnostics/connectivity.sh
  - scripts/diagnostics/dns.sh
  - scripts/diagnostics/performance.sh
  - scripts/aircrack-ng/examples.sh
  - scripts/curl/examples.sh
  - scripts/dig/examples.sh
  - scripts/ffuf/examples.sh
  - scripts/foremost/examples.sh
  - scripts/gobuster/examples.sh
  - scripts/hashcat/examples.sh
  - scripts/hping3/examples.sh
  - scripts/john/examples.sh
  - scripts/metasploit/examples.sh
  - scripts/netcat/examples.sh
  - scripts/nikto/examples.sh
  - scripts/nmap/examples.sh
  - scripts/skipfish/examples.sh
  - scripts/sqlmap/examples.sh
  - scripts/traceroute/examples.sh
  - scripts/tshark/examples.sh
autonomous: true

must_haves:
  truths:
    - "All 9 lib/*.sh modules have @description, @usage, and @dependencies fields in the first 10 lines"
    - "All 3 utility scripts (common.sh, check-tools.sh, check-docs-completeness.sh) have conformant headers"
    - "All 3 diagnostics scripts have conformant headers"
    - "All 17 examples.sh scripts have conformant headers"
    - "Headers are pure comments with zero behavioral change to any script"
  artifacts:
    - path: "scripts/lib/args.sh"
      contains: "# @description"
    - path: "scripts/common.sh"
      contains: "# @description"
    - path: "scripts/nmap/examples.sh"
      contains: "# @description"
  key_links:
    - from: "header block"
      to: "shebang line"
      via: "placed between shebang and first source/set/code line"
      pattern: "head -10.*@description"
---

<objective>
Add structured metadata headers to all examples.sh scripts (17), all lib/*.sh modules (9), and all utility/diagnostics scripts (7). This covers HDR-01 (format definition), HDR-02, HDR-04, and HDR-05.

Purpose: Establish the header format and apply it to all non-use-case scripts (33 files), enabling machine-parseable metadata extraction.
Output: 33 script files with conformant `@description`, `@usage`, `@dependencies` headers.
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-script-metadata-headers/22-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add headers to lib modules, common.sh, check-tools.sh, check-docs-completeness.sh, and diagnostics scripts (16 files)</name>
  <files>
    scripts/lib/args.sh
    scripts/lib/cleanup.sh
    scripts/lib/colors.sh
    scripts/lib/diagnostic.sh
    scripts/lib/logging.sh
    scripts/lib/nc_detect.sh
    scripts/lib/output.sh
    scripts/lib/strict.sh
    scripts/lib/validation.sh
    scripts/common.sh
    scripts/check-tools.sh
    scripts/check-docs-completeness.sh
    scripts/diagnostics/connectivity.sh
    scripts/diagnostics/dns.sh
    scripts/diagnostics/performance.sh
  </files>
  <action>
    Replace the existing comment header block (lines between the shebang and the first code/source line) in each file with the structured `@field` annotation format.

    **Header format (bordered comment block, 76 `=` characters):**
    ```
    # ============================================================================
    # @description  One-line description
    # @usage        How to invoke or source
    # @dependencies What this needs
    # ============================================================================
    ```

    **For each lib module** (9 files): Replace the 2-line comment header (e.g., `# logging.sh -- ...` and `# Provides ...`) with the bordered block. Place before the source guard. Use `@usage Sourced via common.sh (not invoked directly)`. Set `@dependencies` to other lib modules loaded before it (e.g., logging.sh depends on `colors.sh`; strict.sh depends on `None`; args.sh depends on `None`; cleanup.sh depends on `None`; colors.sh depends on `None`; diagnostic.sh depends on `colors.sh, logging.sh`; nc_detect.sh depends on `None`; output.sh depends on `colors.sh`; validation.sh depends on `colors.sh, logging.sh`).

    **For common.sh:** Replace the multi-line comment block (4 lines) with the bordered block. `@usage source "$(dirname "$0")/../common.sh"`. `@dependencies lib/strict.sh, lib/colors.sh, lib/logging.sh, lib/cleanup.sh, lib/output.sh, lib/args.sh, lib/validation.sh, lib/nc_detect.sh, lib/diagnostic.sh`.

    **For check-tools.sh:** Replace the single-line comment. `@usage check-tools.sh [-h|--help]`. `@dependencies common.sh`.

    **For check-docs-completeness.sh:** Replace the single-line comment. `@usage check-docs-completeness.sh`. `@dependencies None (standalone)`. Place before `set -euo pipefail`.

    **For diagnostics scripts (3 files):** Replace the multi-line comment block (3-4 lines) with bordered block. Keep the Pattern B note as a regular comment AFTER the bordered block. `@usage diagnostics/<name>.sh [target] [-h|--help]`. `@dependencies` per script: dns.sh needs `dig, common.sh`; connectivity.sh needs `dig, curl, common.sh`; performance.sh needs `traceroute, mtr, common.sh`.

    **Critical rules:**
    - Every line in the header block MUST start with `#`
    - The bordered block goes between shebang (line 1) and the first functional line (source, set, code)
    - Preserve exact blank lines and code structure after the header
    - Keep existing descriptions accurate -- just reformat, do not invent new descriptions
  </action>
  <verify>
    For each modified file: `head -10 FILE | grep -c '# @description'` returns 1.
    `bash -n FILE` exits 0 for each file (syntax check).
    Spot-check: `head -7 scripts/lib/logging.sh` shows bordered block with @description, @usage, @dependencies.
  </verify>
  <done>
    All 16 files (9 lib, 3 utility, 3 diagnostics, 1 common.sh) have the 3 required @-annotated fields within the first 10 lines, with zero syntax errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add headers to all 17 examples.sh scripts</name>
  <files>
    scripts/aircrack-ng/examples.sh
    scripts/curl/examples.sh
    scripts/dig/examples.sh
    scripts/ffuf/examples.sh
    scripts/foremost/examples.sh
    scripts/gobuster/examples.sh
    scripts/hashcat/examples.sh
    scripts/hping3/examples.sh
    scripts/john/examples.sh
    scripts/metasploit/examples.sh
    scripts/netcat/examples.sh
    scripts/nikto/examples.sh
    scripts/nmap/examples.sh
    scripts/skipfish/examples.sh
    scripts/sqlmap/examples.sh
    scripts/traceroute/examples.sh
    scripts/tshark/examples.sh
  </files>
  <action>
    Replace the single-line comment header (e.g., `# nmap/examples.sh -- Network Mapper: host discovery and port scanning`) in each examples.sh with the bordered annotation block.

    **Format for every examples.sh:**
    ```
    # ============================================================================
    # @description  <existing description from the current single-line comment>
    # @usage        <tool>/examples.sh <target> [-h|--help] [-v|--verbose] [-x|--execute]
    # @dependencies <tool>, common.sh
    # ============================================================================
    ```

    **Per-script @description and @dependencies values (preserve existing descriptions):**
    - aircrack-ng: `Wireless network auditing examples using aircrack-ng` / `aircrack-ng, common.sh`
    - curl: `HTTP client request examples using curl` / `curl, common.sh`
    - dig: `DNS lookup and query examples using dig` / `dig, common.sh`
    - ffuf: `Web fuzzing examples using ffuf` / `ffuf, common.sh`
    - foremost: `File carving and recovery examples using foremost` / `foremost, common.sh`
    - gobuster: `Directory and subdomain brute-force examples using gobuster` / `gobuster, common.sh`
    - hashcat: `Password hash cracking examples using hashcat` / `hashcat, common.sh`
    - hping3: `TCP/IP packet crafting examples using hping3` / `hping3, common.sh`
    - john: `Password cracking examples using John the Ripper` / `john, common.sh`
    - metasploit: `Exploitation framework examples using Metasploit` / `msfconsole, common.sh`
    - netcat: `Network Swiss Army knife examples using netcat` / `nc, common.sh`
    - nikto: `Web server vulnerability scanning examples using nikto` / `nikto, common.sh`
    - nmap: `Network scanning and host discovery examples using nmap` / `nmap, common.sh`
    - skipfish: `Web application security scanner examples using skipfish` / `skipfish, common.sh`
    - sqlmap: `SQL injection detection and exploitation examples using sqlmap` / `sqlmap, common.sh`
    - traceroute: `Network path tracing examples using traceroute` / `traceroute, common.sh`
    - tshark: `Network traffic analysis examples using tshark` / `tshark, common.sh`

    Read each file's current line 2 (the existing comment) to get the accurate description. Adapt from the existing text.

    **Critical:** The header replaces line 2 (the old single-line comment). Line 1 stays as shebang. The `source` line immediately follows the closing border.
  </action>
  <verify>
    For each examples.sh: `head -7 FILE | grep -c '# @description'` returns 1.
    `bash -n FILE` exits 0 for each file.
    Spot-check: `head -7 scripts/nmap/examples.sh` shows bordered block.
  </verify>
  <done>
    All 17 examples.sh files have conformant bordered header blocks with @description, @usage, @dependencies in the first 7 lines.
  </done>
</task>

</tasks>

<verification>
1. `for f in scripts/lib/*.sh scripts/common.sh scripts/check-tools.sh scripts/check-docs-completeness.sh scripts/diagnostics/*.sh scripts/*/examples.sh; do head -10 "$f" | grep -q '# @description' && head -10 "$f" | grep -q '# @usage' && head -10 "$f" | grep -q '# @dependencies' || echo "MISSING: $f"; done` — no output means all 33 files pass.
2. `for f in scripts/lib/*.sh scripts/common.sh scripts/check-tools.sh scripts/check-docs-completeness.sh scripts/diagnostics/*.sh scripts/*/examples.sh; do bash -n "$f" || echo "SYNTAX ERROR: $f"; done` — no syntax errors.
3. Existing tests still pass: `make test` (or `bats tests/`) shows no regressions.
</verification>

<success_criteria>
- 33 script files have structured `@description`, `@usage`, `@dependencies` headers
- All headers are within the first 10 lines of each file
- Zero syntax errors across all modified files
- Existing BATS tests pass with no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/22-script-metadata-headers/22-01-SUMMARY.md`
</output>
